"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),_jqmin=require("jqmin"),_jqmin2=_interopRequireDefault(_jqmin),_AX6UICore2=require("./AX6UICore.js"),_AX6UICore3=_interopRequireDefault(_AX6UICore2),_AX6Info=require("./AX6Info"),_AX6Info2=_interopRequireDefault(_AX6Info),_AX6Util=require("./AX6Util"),_AX6Util2=_interopRequireDefault(_AX6Util),_AX6Mustache=require("./AX6Mustache"),_AX6Mustache2=_interopRequireDefault(_AX6Mustache),ctrlKeys={18:"KEY_ALT",17:"KEY_CONTROL",46:"KEY_DELETE",40:"KEY_DOWN",35:"KEY_END",187:"KEY_EQUAL",36:"KEY_HOME",45:"KEY_INSERT",37:"KEY_LEFT",189:"KEY_MINUS",34:"KEY_PAGEDOWN",33:"KEY_PAGEUP",39:"KEY_RIGHT",16:"KEY_SHIFT",9:"KEY_TAB",38:"KEY_UP",91:"KEY_WINDOW"},tmpl={optionGroup:function(e){return'\n<div class="ax6ui-autocomplete-option-group {{theme}} {{size}}" data-ax6ui-autocomplete-option-group="{{id}}">\n    <div class="ax-autocomplete-body">\n        <div class="ax-autocomplete-option-group-content" data-els="content"></div>\n    </div>\n    <div class="ax-autocomplete-arrow"></div> \n</div>\n'},autocompleteDisplay:function(e){return' \n<input tabindex="-1" type="text" data-input-dummy="" style="display: none;" />\n<div class="ax6ui-autocomplete-display {{theme}}" data-ax6ui-autocomplete-display="{{id}}" data-ax6ui-autocomplete-instance="{{instanceId}}" style="height: {{height}}px;">\n    <div class="ax6ui-autocomplete-display-table" data-els="display-table">\n        <div data-ax6ui-autocomplete-display="label-holder"> \n          <a {{^tabIndex}}{{/tabIndex}}{{#tabIndex}}tabindex="{{tabIndex}}" {{/tabIndex}} data-ax6ui-autocomplete-display="label" spellcheck="false" style="padding: 0 {{paddingLeft}}px;">\n              <input type="text" data-ax6ui-autocomplete-display="input" style="border:0 none;height: {{optionItemHeight}}px;line-height: {{optionItemHeight}}px;" />\n          </a>\n        </div>\n        <div data-ax6ui-autocomplete-display="addon"> \n            {{#multiple}}{{#reset}}\n            <span class="addon-icon-reset" data-selected-clear="true">{{{.}}}</span>\n            {{/reset}}{{/multiple}}\n        </div>\n    </div>\n</div>\n'},formSelect:function(e){return'\n<select tabindex="-1" class="form-control {{formSize}}" name="{{name}}" multiple="multiple"></select>\n'},formSelectOptions:function(e){return'\n{{#selected}}\n<option value="{{'+e.optionValue+'}}" selected="true">{{'+e.optionText+"}}</option>\n{{/selected}}\n"},options:function(e){return'\n{{#waitOptions}}\n    <div class="ax-autocomplete-option-item">\n            <div class="ax-autocomplete-option-item-holder">\n                <span class="ax-autocomplete-option-item-cell ax-autocomplete-option-item-label">\n                    {{{lang.loading}}}\n                </span>\n            </div>\n        </div>\n{{/waitOptions}}\n{{^waitOptions}}\n    {{#options}}\n        {{^hide}}\n        <div class="ax-autocomplete-option-item" data-option-focus-index="{{@findex}}" data-option-index="{{@index}}" data-option-value="{{'+e.optionValue+'}}" {{#'+e.optionSelected+'}}data-option-selected="true"{{/'+e.optionSelected+'}}>\n            <div class="ax-autocomplete-option-item-holder">\n                <span class="ax-autocomplete-option-item-cell ax-autocomplete-option-item-label">{{'+e.optionText+'}}</span>\n            </div>\n        </div>\n        {{/hide}}\n    {{/options}}\n    {{^options}}\n        <div class="ax-autocomplete-option-item">\n            <div class="ax-autocomplete-option-item-holder">\n                <span class="ax-autocomplete-option-item-cell ax-autocomplete-option-item-label">\n                    {{{lang.noOptions}}}\n                </span>\n            </div>\n        </div>\n    {{/options}}\n{{/waitOptions}}\n'},label:function(e){return'{{#selected}}\n<div tabindex="-1" data-ax6ui-autocomplete-selected-label="{{@i}}" data-ax6ui-autocomplete-selected-text="{{text}}" style="height: {{optionItemHeight}}px;">  \n  <div class="label-cell">{{'+e.optionText+'}}</div>\n  <div class="label-cell" data-ax6ui-autocomplete-remove="true" data-ax6ui-autocomplete-remove-index="{{@i}}">{{{removeIcon}}}</div>\n</div>{{/selected}}'}},onStateChanged=function(e,t){return e&&e.onStateChanged?e.onStateChanged.call(t,t):this.onStateChanged&&this.onStateChanged.call(t,t),"changeValue"==t.state&&(e&&e.onChange?e.onChange.call(t,t):this.onChange&&this.onChange.call(t,t)),e=null,t=null,!0},alignAutocompleteDisplay=function(){for(var e=this,t=this.queue.length,i=void 0;t--;){var o,l;!function(){var n=e.queue[t];n.$display&&(i=Math.max(n.$select.outerWidth(),_AX6Util2.default.number(n.minWidth)),n.$display.css({"min-width":i}),n.reset&&n.$display.find(".addon-icon-reset").css({"line-height":e.queue[t].$display.height()+"px"}),n.multiple&&(o=function(){return _AX6Util2.default.number(n.$display.css("border-top-width"))+_AX6Util2.default.number(n.$display.css("border-bottom-width"))}.call(e),n.$target.height(""),n.$display.height(""),l=n.$displayTable.outerHeight(),Math.abs(l-n.$target.height())>o&&(n.$target.css({height:l+o+4}),n.$display.css({height:l+o+4}))))}()}return t=null,i=null,this},alignAutocompleteOptionGroup=function(e){if(e&&!this.activeautocompleteOptionGroup)return this;var t=this.queue[this.activeautocompleteQueueIndex],i={},o={},l={},n=void 0;if(!t)return this;e&&(0,_jqmin2.default)(document.body).append(this.activeautocompleteOptionGroup),i=t.$target.offset(),o={width:t.$target.outerWidth(),height:t.$target.outerHeight()},l={winWidth:Math.max((0,_jqmin2.default)(window).width(),(0,_jqmin2.default)(document.body).width()),winHeight:Math.max((0,_jqmin2.default)(window).height(),(0,_jqmin2.default)(document.body).height()),width:this.activeautocompleteOptionGroup.outerWidth(),height:this.activeautocompleteOptionGroup.outerHeight()},t.direction&&""!==t.direction&&"auto"!==t.direction?n=t.direction:(n="top",i.top-l.height-0<0?n="top":i.top+o.height+l.height+0>l.winHeight&&(n="bottom")),e&&this.activeautocompleteOptionGroup.addClass("direction-"+n),this.activeautocompleteOptionGroup.css(function(){if("top"==n){if(i.top+o.height+l.height+0>l.winHeight){var e=i.top+l.height;return e+l.height+0>l.winHeight&&(e=0),e<0&&(e=0),{left:i.left,top:e,width:o.width}}return{left:i.left,top:i.top+o.height+1,width:o.width}}if("bottom"==n)return{left:i.left,top:i.top-l.height-1,width:o.width}}.call(this))},onBodyClick=function(e,t){if(!this.activeautocompleteOptionGroup)return this;var i=this.queue[this.activeautocompleteQueueIndex],o="display";return(t=_AX6Util2.default.findParentNode(e.target,function(e){return e.getAttribute("data-option-value")?(o="optionItem",!0):i.$target.get(0)==e?(o="display",!0):void 0}))?("optionItem"===o&&(setSelected.call(this,i.id,{optionIndex:{index:t.getAttribute("data-option-index")}},void 0,"optionItemClick"),alignAutocompleteDisplay.call(this),alignAutocompleteOptionGroup.call(this),i.multiple||this.close()),this):(this.close(),this)},getLabel=function(e){var t=this.queue[e],i={};return i.id=t.id,i.theme=t.theme,i.multiple=t.multiple,i.lang=t.lang,i.options=t.options,i.selected=t.selected,i.hasSelected=i.selected&&i.selected.length>0,i.removeIcon=t.removeIcon,i.height=t.height,i.optionItemHeight=t.optionItemHeight,_AX6Mustache2.default.render(tmpl.label.call(this,t.columnKeys),i)},syncLabel=function(e){var t=this.queue[e];!t.multiple&&t.selected&&t.selected.length>0&&(t.selected=[].concat(t.selected[t.selected.length-1])),t.selected.forEach(function(e,t){e["@index"]=t}),t.$select.html(_AX6Mustache2.default.render(tmpl.formSelectOptions.call(this,t.columnKeys),{selected:t.selected}))},printLabel=function(e){var t=this.queue[e];t.$displayLabel.find("[data-ax6ui-autocomplete-selected-label]").remove(),t.$displayLabelInput.before(getLabel.call(this,e))},focusLabel=function(e){if(this.queue[e].disabled)return this;this.queue[e].$displayLabel.trigger("focus"),this.queue[e].$displayLabelInput.focus()},clearLabel=function(e){this.queue[e].$displayLabelInput.val("")},blurLabel=function(e){this.queue[e].$displayLabel.trigger("blur")},onSearch=function(e,t){if(-1==this.activeautocompleteQueueIndex)return this;var i=/[\{\}\[\]\/?.,;:|\)*~`!^\-_+<>@\#$%&\\\=\(\'\"]/gi;t=t.replace(i,""),this.queue[e].waitOptions=!0,this.queue[e].onSearch.call({self:this,item:this.queue[e],searchWord:t},function(e){var i={},o=this.queue[this.activeautocompleteQueueIndex];if(!o)return!1;!function(e,t){var i={};t.options.forEach(function(t,o){t["@index"]=o,t["@findex"]=o,i[t[e.columnKeys.optionValue]]=t}),_AX6Util2.default.isArray(e.selected)&&e.selected.forEach(function(o){i[o[e.columnKeys.optionValue]]&&(t.options[i[o[e.columnKeys.optionValue]]["@index"]][e.columnKeys.optionSelected]=!0)})}(o,e),o.options=e.options,alignAutocompleteDisplay.call(this),i.id=o.id,i.theme=o.theme,i.multiple=o.multiple,i.lang=o.lang,i.options=o.options,this.activeautocompleteOptionGroup.find('[data-els="content"]').html(_AX6Mustache2.default.render(tmpl.options.call(this,o.columnKeys),i)),focusWord.call(this,this.activeautocompleteQueueIndex,t),alignAutocompleteOptionGroup.call(this),setTimeout(function(){alignAutocompleteOptionGroup.call(this)}.bind(this))}.bind(this))},focusWord=function(e,t){if(-1==this.activeautocompleteQueueIndex)return this;var i=[],o=-1,l=this.queue[e].options.length-1,n=void 0;if(""!=t){for(;l-o++;){if((""+(n=this.queue[e].options[o]).text).toLowerCase()==t.toLowerCase()){i=[{"@findex":n["@findex"],optionsSort:0}];break}var a=(""+n.text).toLowerCase().search(t.toLowerCase());if(a>-1&&(i.push({"@findex":n["@findex"],optionsSort:a}),i.length>2))break;a=null}i.sort(function(e,t){return e.optionsSort-t.optionsSort})}i&&i.length>0?focusMove.call(this,e,void 0,i[0]["@findex"]):focusClear.call(this,e)},focusClear=function(e){this.activeautocompleteOptionGroup&&this.activeautocompleteOptionGroup.find("[data-option-focus-index]").removeClass("hover").removeAttr("data-option-selected"),this.queue[e].optionFocusIndex=-1},focusMove=function(e,t,i){var o=void 0,l=void 0,n=void 0,a=void 0,u=this.queue[e];if(this.activeautocompleteOptionGroup&&u.options&&u.options.length>0){if(void 0!==i?o=i:-1==(l=-1==u.optionFocusIndex?u.optionSelectedIndex||-1:u.optionFocusIndex)?o=0:(o=l+t)<0?o=0:o>u.optionItemLength-1&&(o=u.optionItemLength-1),u.optionFocusIndex=o,u.options[o]&&u.options[o].hide){if(void 0===t)return this;for(;u.options[o].hide;){if((o+=t)<0){o=0;break}if(o>u.optionItemLength-1){o=u.optionItemLength-1;break}}}if(void 0!==o&&(this.activeautocompleteOptionGroup.find("[data-option-focus-index]").removeClass("hover"),n=this.activeautocompleteOptionGroup.find('[data-option-focus-index="'+o+'"]').addClass("hover"),a=this.activeautocompleteOptionGroup.find('[data-els="content"]'),n.get(0))){var s=n.outerHeight(),c=a.innerHeight(),d=a.scrollTop(),p=n.position().top+a.scrollTop();c+d<p+s?a.scrollTop(p+s-c):d>p&&a.scrollTop(p),void 0!==t&&u.$displayLabelInput.val(u.options[o].text)}}},bindAutocompleteTarget=function(e){var t=this.queue[e],i={},o=_AX6Util2.default.debounce(function(e){if(-1==this.activeautocompleteQueueIndex)return this;onSearch.call(this,e,this.queue[e].$displayLabelInput.val())},100).bind(this),l={click:function(e,t){var i="",o=_AX6Util2.default.findParentNode(t.target,function(e){return e.getAttribute("data-ax6ui-autocomplete-remove")?(i="optionItemRemove",!0):e.getAttribute("data-selected-clear")?(i="clear",!0):void 0});if(o){if("optionItemRemove"===i){var l=o.getAttribute("data-ax6ui-autocomplete-remove-index");return this.queue[e].selected.splice(l,1),syncLabel.call(this,e),printLabel.call(this,e),focusLabel.call(this,e),alignAutocompleteDisplay.call(this),alignAutocompleteOptionGroup.call(this),_AX6Util2.default.stopEvent(t),this}"clear"===i&&(setSelected.call(this,e,{clear:!0}),alignAutocompleteDisplay.call(this),alignAutocompleteOptionGroup.call(this))}else this.activeautocompleteQueueIndex==e?-1==this.queue[e].optionFocusIndex&&this.close():focusLabel.call(this,e)},keyUp:function(e,t){return t.which==_AX6Info2.default.eventKeys.ESC&&-1===this.activeautocompleteQueueIndex?(_AX6Util2.default.stopEvent(t),this):t.which==_AX6Info2.default.eventKeys.TAB?(this.close(),this):(this.activeautocompleteQueueIndex!=e&&t.which!=_AX6Info2.default.eventKeys.BACKSPACE&&(this.open(e),o(e)),void(ctrlKeys[t.which]?_AX6Util2.default.stopEvent(t):t.which==_AX6Info2.default.eventKeys.BACKSPACE&&""==this.queue[e].$displayLabelInput.val()?(this.queue[e].selected.pop(),syncLabel.call(this,e),printLabel.call(this,e),focusLabel.call(this,e),alignAutocompleteDisplay.call(this),alignAutocompleteOptionGroup.call(this),_AX6Util2.default.stopEvent(t)):o(e)))},keyDown:function(e,t){var i=this.queue[e];if(t.which==_AX6Info2.default.eventKeys.ESC)clearLabel.call(this,e),this.close(),_AX6Util2.default.stopEvent(t);else if(t.which==_AX6Info2.default.eventKeys.RETURN){var o=i.$displayLabelInput.val();i.optionFocusIndex>-1?setSelected.call(this,i.id,{optionIndex:{index:i.optionFocusIndex}},void 0,"optionItemClick"):""!=o&&setSelected.call(this,e,o,!0),clearLabel.call(this,e),alignAutocompleteDisplay.call(this),this.close(),_AX6Util2.default.stopEvent(t)}else t.which==_AX6Info2.default.eventKeys.DOWN?(focusMove.call(this,e,1),_AX6Util2.default.stopEvent(t)):t.which==_AX6Info2.default.eventKeys.UP&&(focusMove.call(this,e,-1),_AX6Util2.default.stopEvent(t))},focus:function(e,t){},blur:function(e,t){n.call(this,e),_AX6Util2.default.stopEvent(t)},selectChange:function(e,i){setSelected.call(this,e,{value:t.$select.val()},!0)}},n=function(e){clearLabel.call(this,e)};return t.$display?printLabel.call(this,e):(i.instanceId=this.instanceId,i.id=t.id,i.name=t.name,i.theme=t.theme,i.tabIndex=t.tabIndex,i.multiple=t.multiple,i.reset=t.reset,i.height=t.height,i.optionItemHeight=t.optionItemHeight,i.paddingLeft=(t.height-t.optionItemHeight)/2,i.label=getLabel.call(this,e),t.$display=(0,_jqmin2.default)(_AX6Mustache2.default.render(tmpl.autocompleteDisplay.call(this,t.columnKeys),i)),t.$displayTable=t.$display.find('[data-els="display-table"]'),t.$displayLabel=t.$display.find('[data-ax6ui-autocomplete-display="label"]'),t.$displayLabelInput=t.$display.find('[data-ax6ui-autocomplete-display="input"]'),t.$target.find("select").get(0)?(t.$select=t.$target.find("select"),t.$select.attr("tabindex","-1").attr("class","form-control "+i.formSize),i.name&&t.$select.attr("name","name"),t.$select.attr("multiple","multiple")):(t.$select=(0,_jqmin2.default)(_AX6Mustache2.default.render(tmpl.formSelect.call(this,t.columnKeys),i)),t.$target.append(t.$select)),t.$target.append(t.$display)),alignAutocompleteDisplay.call(this),t.$display.off("click.ax6ui-autocomplete").on("click.ax6ui-autocomplete",l.click.bind(this,e)),t.$displayLabelInput.off("focus.ax6ui-autocomplete").on("focus.ax6ui-autocomplete",l.focus.bind(this,e)).off("blur.ax6ui-autocomplete").on("blur.ax6ui-autocomplete",l.blur.bind(this,e)).off("keydown.ax6ui-autocomplete").on("keydown.ax6ui-autocomplete",l.keyDown.bind(this,e)).off("keyup.ax6ui-autocomplete").on("keyup.ax6ui-autocomplete",l.keyUp.bind(this,e)),i=null,t=null,e=null,this},getQueIdx=function(e){e instanceof _jqmin2.default?e=e.data("data-ax6ui-autocomplete-id"):_AX6Util2.default.isString(e)||(e=(0,_jqmin2.default)(e).data("data-ax6ui-autocomplete-id"));{if(_AX6Util2.default.isString(e))return _AX6Util2.default.search(this.queue,function(){return this.id==e});console.log(_AX6Info2.default.getError("ax6ui-autocomplete","402","getQueIdx"))}},getSelected=function(e,t,i){return void 0===i?!e.multiple||!t:i},clearSelected=function(e){this.queue[e].options.forEach(function(e){e.optgroup?e.options.forEach(function(e){e.selected=!1}):e.selected=!1}),this.queue[e].selected=[],this.queue[e].$select.html(_AX6Mustache2.default.render(tmpl.formSelectOptions.call(this,this.queue[e].columnKeys),{selected:this.queue[e].selected}))},setSelected=function(e,t,i,o){var l={selectedIndex:function(e,t,i,o){},removeSelectedIndex:function(e,t,i,o){for(var l=this.queue[e],n={},a=[],u=0,s=0;s<l.selected.length;s++)l.selected[s]["@index"]!=t.removeSelectedIndex.index&&((n={"@index":u,"@findex":u})[l.columnKeys.optionValue]=l.selected[s][l.columnKeys.optionValue],n[l.columnKeys.optionText]=l.selected[s][l.columnKeys.optionText],a.push(n),u++);l.selected=a},optionIndex:function(e,t,i,o){var l=this.queue[e],n={},a=l.selected.length,u=!0;(n={"@index":a,"@findex":a})[l.columnKeys.optionValue]=l.options[t.optionIndex.index][l.columnKeys.optionValue],n[l.columnKeys.optionText]=l.options[t.optionIndex.index][l.columnKeys.optionText];for(var s=0;s<l.selected.length;s++)l.selected[s][l.columnKeys.optionValue]==n[l.columnKeys.optionValue]&&(u=!1);u&&l.selected.push(n)},arr:function(e,t,i,o){t.forEach(function(t){if(_AX6Util2.default.isString(t)||_AX6Util2.default.isNumber(t))l.text.call(self,e,t,i,"justSetValue");else for(var o in l)if(t[o]){l[o].call(self,e,t,i,"justSetValue");break}})},value:function(e,t,i,o){var l,n=this.queue[e],a=_AX6Util2.default.search(n.options,function(){return this[n.columnKeys.optionValue]==t.value[n.columnKeys.optionValue]});if(a>-1)if(n.options[a][n.columnKeys.optionSelected]=getSelected(n,n.options[a][n.columnKeys.optionSelected],i),n.options[a][n.columnKeys.optionSelected]){for(var u=!0,s=0;s<n.selected.length;s++)if(n.selected[s][this.config.columnKeys.optionValue]==n.options[a][this.config.columnKeys.optionValue]){u=!1;break}u&&((l={})[n.columnKeys.optionValue]=n.options[a][n.columnKeys.optionValue],l[n.columnKeys.optionText]=n.options[a][n.columnKeys.optionText],n.selected.push(l))}else{for(var c=[],s=0;s<n.selected.length;s++)n.selected[s][this.config.columnKeys.optionValue]==n.options[a][this.config.columnKeys.optionValue]||((l={})[n.columnKeys.optionValue]=n.selected[s][n.columnKeys.optionValue],l[n.columnKeys.optionText]=n.selected[s][n.columnKeys.optionText],c.push(l));n.selected=c}else{for(var u=!0,s=0;s<n.selected.length;s++)if(n.selected[s][this.config.columnKeys.optionValue]==t.value[this.config.columnKeys.optionValue]){u=!1;break}u&&((l={})[n.columnKeys.optionValue]=t.value[this.config.columnKeys.optionValue],l[n.columnKeys.optionText]=t.value[this.config.columnKeys.optionText],n.selected.push(l))}},text:function(e,t,i,o){var l,n=this.queue[e],a=_AX6Util2.default.search(n.options,function(){return this[n.columnKeys.optionText]==t});if(a>-1)if(n.options[a][n.columnKeys.optionSelected]=getSelected(n,n.options[a][n.columnKeys.optionSelected],i),n.options[a][n.columnKeys.optionSelected]){for(var u=!0,s=0;s<n.selected.length;s++)if(n.selected[s][this.config.columnKeys.optionText]==n.options[a][this.config.columnKeys.optionText]){u=!1;break}u&&((l={})[n.columnKeys.optionValue]=n.options[a][n.columnKeys.optionValue],l[n.columnKeys.optionText]=n.options[a][n.columnKeys.optionText],n.selected.push(l))}else{for(var c=[],s=0;s<n.selected.length;s++)n.selected[s][this.config.columnKeys.optionText]==n.options[a][this.config.columnKeys.optionText]||((l={})[n.columnKeys.optionValue]=n.selected[s][n.columnKeys.optionValue],l[n.columnKeys.optionText]=n.selected[s][n.columnKeys.optionText],c.push(l));n.selected=c}else{for(var u=!0,s=0;s<n.selected.length;s++)if(n.selected[s][this.config.columnKeys.optionText]==t){u=!1;break}u&&((l={})[n.columnKeys.optionValue]=t,l[n.columnKeys.optionText]=t,n.selected.push(l))}},clear:function(e){clearSelected.call(this,e),focusClear.call(this,e),this.activeautocompleteOptionGroup&&this.activeautocompleteOptionGroup.find("[data-option-index]").attr("data-option-Selected","false"),this.queue[e].optionSelectedIndex=-1}},n=_AX6Util2.default.isNumber(e)?e:getQueIdx.call(this,e);if(-1!==n){if(void 0===t)throw"error not found value";if(_AX6Util2.default.isArray(t))l.clear.call(this,n),l.arr.call(this,n,this.queue[n].multiple||0==t.length?t:[t[t.length-1]],i);else if(_AX6Util2.default.isString(t)||_AX6Util2.default.isNumber(t))void 0===t||null===t||this.queue[n].multiple||clearSelected.call(this,n),l.text.call(this,n,t,i);else if(null===t)l.clear.call(this,n);else{this.queue[n].multiple||clearSelected.call(this,n);for(var a in l)if(t[a]){l[a].call(this,n,t,i);break}}return syncLabel.call(this,n),printLabel.call(this,n),focusLabel.call(this,n),alignAutocompleteOptionGroup.call(this),void 0!==t&&o&&!o.noStateChange&&onStateChanged.call(this,this.queue[n],{self:this,item:this.queue[n],state:"changeValue",value:this.queue[n].selected}),e=null,this}console.log(_AX6Info2.default.getError("ax6ui-autocomplete","402","val"))},AX6UIAutocomplete=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.config={theme:"default",animateTime:250,height:34,optionItemHeight:24,borderWidth:1,removeIcon:"U+00d7",lang:{noSelected:"",noOptions:"no options",loading:"Now Processing"},columnKeys:{optionValue:"value",optionText:"text",optionSelected:"selected"}},_jqmin2.default.extend(!0,i.config,e),i.queue=[],i.activeautocompleteOptionGroup=null,i.activeautocompleteQueueIndex=-1,i.openTimer=null,i.closeTimer=null,i.waitOptionsCallback=null,i.keyUpTimer=null,i.xvar={},i.init(),i}return _inherits(t,_AX6UICore3.default),_createClass(t,[{key:"init",value:function(){this.onStateChanged=this.config.onStateChanged,delete this.config.onStateChanged,this.onChange=this.config.onChange,delete this.config.onChange,this.initOnce()}},{key:"initOnce",value:function(){if(this.initialized)return this;this.initialized=!0,(0,_jqmin2.default)(window).on("resize.ax6ui-autocomplete-display-"+this.instanceId,_AX6Util2.default.throttle(function(e){alignAutocompleteDisplay.call(this,e||window.event),alignAutocompleteOptionGroup.call(this)},100).bind(this))}},{key:"bind",value:function(e){var t=void 0;return(e=_jqmin2.default.extend(!0,{},this.config,e)).target?(e.$target=(0,_jqmin2.default)(e.target),e.id||(e.id=e.$target.data("data-ax6ui-autocomplete-id")),e.id||(e.id="ax6ui-autocomplete-"+_AX6UICore3.default.getInstanceId(),e.$target.data("data-ax6ui-autocomplete-id",e.id)),e.name=e.$target.attr("data-ax6ui-autocomplete"),e.options=[],e.selected=[],function(t){_AX6Util2.default.isObject(t)&&!t.error&&(e=_jqmin2.default.extend(!0,e,t))}(_AX6Util2.default.parseJson(e.$target.attr("data-ax6ui-autocomplete-config"),!0)),-1===(t=_AX6Util2.default.search(this.queue,function(){return this.id==e.id}))?(this.queue.push(e),bindAutocompleteTarget.call(this,this.queue.length-1)):(this.queue[t].selected=[],this.queue[t].options=e.options,this.queue[t]=_jqmin2.default.extend(!0,{},this.queue[t],e),bindAutocompleteTarget.call(this,t)),t=null,this):(console.log(_AX6Info2.default.getError("ax6ui-autocomplete","401","bind")),this)}},{key:"open",value:function(e,t){this.waitOptionsCallback=null;var i=_AX6Util2.default.isNumber(e)?e:getQueIdx.call(this,e),o=this.queue[i],l={},n=void 0,a=void 0;return o.$display.attr("disabled")?this:(this.openTimer&&clearTimeout(this.openTimer),this.activeautocompleteOptionGroup?this.activeautocompleteQueueIndex==i?this:t>2?this:(this.close(),this.openTimer=setTimeout(function(){this.open(i,(t||0)+1)}.bind(this),this.config.animateTime),this):(o.optionFocusIndex=-1,o.selected&&o.selected.length>0&&(o.optionSelectedIndex=o.selected[0]["@findex"]),l.id=o.id,l.theme=o.theme,l.multiple=o.multiple,l.lang=o.lang,o.$display.attr("data-autocomplete-option-group-opened","true"),l.waitOptions=!0,l.options=[],this.activeautocompleteOptionGroup=(0,_jqmin2.default)(_AX6Mustache2.default.render(tmpl.optionGroup.call(this,o.columnKeys),l)),this.activeautocompleteOptionGroup.find('[data-els="content"]').html(_AX6Mustache2.default.render(tmpl.options.call(this,o.columnKeys),l)),this.activeautocompleteQueueIndex=i,alignAutocompleteOptionGroup.call(this,"append"),o.selected&&o.selected.length>0&&(a=this.activeautocompleteOptionGroup.find('[data-option-index="'+o.selected[0]["@index"]+'"]')).get(0)&&(n=a.position().top-this.activeautocompleteOptionGroup.height()/3,this.activeautocompleteOptionGroup.find('[data-els="content"]').scrollTop(n)),(0,_jqmin2.default)(window).on("click.ax6ui-autocomplete-"+this.instanceId,function(e){e=e||window.event,onBodyClick.call(this,e),_AX6Util2.default.stopEvent(e)}.bind(this)),onStateChanged.call(this,o,{self:this,state:"open",item:o}),l=null,n=null,a=null,this))}},{key:"setValue",value:function(e,t){var i=_AX6Util2.default.isNumber(e)?e:getQueIdx.call(this,e);{if(-1!==i){if(clearSelected.call(this,i),_AX6Util2.default.isArray(t)){var o=_AX6Util2.default.map(t,function(){return{value:this}});setSelected.call(this,i,o,!0,{noStateChange:!0})}else _AX6Util2.default.isObject(t)?setSelected.call(this,i,{value:t},!0,{noStateChange:!0}):printLabel.call(this,i);return blurLabel.call(this,i),alignAutocompleteDisplay.call(this),this}console.log(_AX6Info2.default.getError("ax6ui-autocomplete","402","val"))}}},{key:"setText",value:function(e,t){var i=_AX6Util2.default.isNumber(e)?e:getQueIdx.call(this,e);{if(-1!==i)return this.queue[i].selected=[],clearSelected.call(this,i),setSelected.call(this,i,t,!0,{noStateChange:!0}),blurLabel.call(this,i),alignAutocompleteDisplay.call(this),this;console.log(_AX6Info2.default.getError("ax6ui-autocomplete","402","val"))}}},{key:"getSelectedOption",value:function(e){var t=_AX6Util2.default.isNumber(e)?e:getQueIdx.call(this,e);{if(-1!==t)return _AX6Util2.default.deepCopy(this.queue[t].selected);console.log(_AX6Info2.default.getError("ax6ui-autocomplete","402","val"))}}},{key:"close",value:function(e){return this.closeTimer&&clearTimeout(this.closeTimer),this.activeautocompleteOptionGroup?(e=this.queue[this.activeautocompleteQueueIndex],e.optionFocusIndex=-1,e.$display.removeAttr("data-autocomplete-option-group-opened").trigger("focus"),this.activeautocompleteOptionGroup.addClass("destroy"),(0,_jqmin2.default)(window).off("resize.ax6ui-autocomplete-"+this.instanceId).off("click.ax6ui-autocomplete-"+this.instanceId).off("keyup.ax6ui-autocomplete-"+this.instanceId),this.closeTimer=setTimeout(function(){this.activeautocompleteOptionGroup&&this.activeautocompleteOptionGroup.remove(),this.activeautocompleteOptionGroup=null,this.activeautocompleteQueueIndex=-1,onStateChanged.call(this,e,{self:this,state:"close"})}.bind(this),this.config.animateTime),this.waitOptionsCallback=null,this):this}},{key:"blur",value:function(e){var t=_AX6Util2.default.isNumber(e)?e:getQueIdx.call(this,e);{if(-1!==t)return blurLabel.call(this,t),this;console.log(_AX6Info2.default.getError("ax6ui-autocomplete","402","val"))}}},{key:"enable",value:function(e){var t=getQueIdx.call(this,e);return void 0!==t&&(this.queue[t].disable=!1,this.queue[t].$display[0]&&(this.queue[t].$display.removeAttr("disabled"),this.queue[t].$displayLabelInput.removeAttr("disabled")),this.queue[t].$select[0]&&this.queue[t].$select.removeAttr("disabled"),onStateChanged.call(this,this.queue[t],{self:this,state:"enable"})),this}},{key:"disable",value:function(e){var t=getQueIdx.call(this,e);return void 0!==t&&(this.queue[t].disable=!0,this.queue[t].$display[0]&&(this.queue[t].$display.attr("disabled","disabled"),this.queue[t].$displayLabelInput.attr("disabled","disabled")),this.queue[t].$select[0]&&this.queue[t].$select.attr("disabled","disabled"),onStateChanged.call(this,this.queue[t],{self:this,state:"disable"})),this}},{key:"align",value:function(){return alignAutocompleteDisplay.call(this),this}}]),t}();exports.default=AX6UIAutocomplete;
//# sourceMappingURL=AX6UIAutocomplete.js.map
