"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),_jqmin=require("jqmin"),_jqmin2=_interopRequireDefault(_jqmin),_AX6UICore2=require("./AX6UICore"),_AX6UICore3=_interopRequireDefault(_AX6UICore2),_AX6Info=require("./AX6Info"),_AX6Info2=_interopRequireDefault(_AX6Info),_AX6Util=require("./AX6Util"),_AX6Util2=_interopRequireDefault(_AX6Util),_AX6UIFormatter_formatter=require("./AX6UIFormatter/AX6UIFormatter_formatter"),_AX6UIFormatter_formatter2=_interopRequireDefault(_AX6UIFormatter_formatter),formatter={},setSelectionRange=function(t,e){if(void 0===e&&(e=t.value.length),t.setSelectionRange)t.focus(),t.setSelectionRange(e,e);else if(t.createTextRange){var r=t.createTextRange();r.collapse(!0),r.moveEnd("character",e),r.moveStart("character",e),r.select()}else t.selectionStart&&(t.focus(),t.selectionStart=e,t.selectionEnd=e)},formatterEvent={focus:function(t,e,r){t.$input.data("__originValue__")||t.$input.data("__originValue__",t.$input.val())},keydown:function(t,e,r){var a=!1;t.enterableKeyCodes&&(r.which&&t.enterableKeyCodes[r.which]||r.metaKey||r.ctrlKey||r.shiftKey||(a=!0)),a&&_AX6Util2.default.stopEvent(r)},keyup:function(t,e,r){var a=t.$input.get(0),n=void 0,i=void 0,o=void 0,u=void 0,l=void 0;"selectionStart"in a?n=a.selectionStart:document.selection&&(u=document.selection.createRange(),l=document.selection.createRange().text.length,u.moveStart("character",-a.value.length),n=u.text.length-l),i=a.value,(o=t.pattern in this.customFormatter?this.customFormatter[t.pattern].getPatternValue.call(this,t,e,r,a.value):t.pattern in _AX6UIFormatter_formatter2.default?_AX6UIFormatter_formatter2.default[t.pattern].getPatternValue.call(this,t,e,r,a.value):i)!=i&&(t.$input.val(o).trigger("change"),setSelectionRange(a,n+o.length-i.length))},blur:function(t,e,r,a){var n=t.$input.get(0),i=void 0,o=void 0;t.$input.removeData("__originValue__"),i=n.value,o=t.pattern in this.customFormatter?this.customFormatter[t.pattern].getPatternValue.call(this,t,e,r,n.value,"blur"):t.pattern in _AX6UIFormatter_formatter2.default?_AX6UIFormatter_formatter2.default[t.pattern].getPatternValue.call(this,t,e,r,n.value,"blur"):i,a?t.$input.val(o):o!=i&&t.$input.val(o).trigger("change")}},bindFormatterTarget=function(t,e){if(!t.pattern&&("INPUT"==t.$target.get(0).tagName?t.pattern=t.$target.attr("data-ax6formatter"):t.pattern=t.$target.find('input[type="text"]').attr("data-ax6formatter"),!t.pattern))return console.log(_AX6Info2.default.getError("ax6formatter","501","bind")),console.log(t.target),this;var r=/[^\(^\))]+/gi,a=t.pattern.match(r);return t.pattern=a[0],t.patternArgument=a[1]||"",t.pattern in this.customFormatter?t.enterableKeyCodes=this.customFormatter[t.pattern].getEnterableKeyCodes.call(this,t,e):t.pattern in _AX6UIFormatter_formatter2.default&&(t.enterableKeyCodes=_AX6UIFormatter_formatter2.default[t.pattern].getEnterableKeyCodes.call(this,t,e)),t.$input.off("focus.ax6formatter").on("focus.ax6formatter",formatterEvent.focus.bind(this,this.queue[e],e)).off("keydown.ax6formatter").on("keydown.ax6formatter",formatterEvent.keydown.bind(this,this.queue[e],e)).off("keyup.ax6formatter").on("keyup.ax6formatter",formatterEvent.keyup.bind(this,this.queue[e],e)).off("blur.ax6formatter").on("blur.ax6formatter",formatterEvent.blur.bind(this,this.queue[e],e)),formatterEvent.blur.call(this,this.queue[e],e),this},unbindFormatterTarget=function(t,e){return t.$input.off("focus.ax6formatter").off("keydown.ax6formatter").off("keyup.ax6formatter").off("blur.ax6formatter"),this},getQueIdx=function(t){return _AX6Util2.default.isString(t)||(t=(0,_jqmin2.default)(t).data("data-formatter")),_AX6Util2.default.search(this.queue,function(){return this.id==t})},AX6UIFormatter=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.config={animateTime:250},_jqmin2.default.extend(!0,r.config,t),r.queue=[],r.openTimer=null,r.closeTimer=null,r.init(),r}return _inherits(e,_AX6UICore3.default),_createClass(e,[{key:"init",value:function(){this.initOnce()}},{key:"initOnce",value:function(){if(this.initialized)return this;this.initialized=!0}},{key:"bind",value:function(t){var r={},a=void 0;if(this.customFormatter=e.getFormatter(),_jqmin2.default.extend(!0,r,this.config),t&&_jqmin2.default.extend(!0,r,t),!(t=r).target)return console.log(_AX6Info2.default.getError("ax6formatter","401","bind")),this;if(t.$target=(0,_jqmin2.default)(t.target),!t.$target.get(0))return console.log(_AX6Info2.default.getError("ax6formatter","401","can't found target element")),this;if("INPUT"==t.$target.get(0).tagName)t.$input=t.$target;else if(t.$input=t.$target.find('input[type="text"]'),t.$input.length>1)return t.$input.each(function(){t.target=this,self.bind(t)}),this;return t.$input="INPUT"==t.$target.get(0).tagName?t.$target:t.$target.find('input[type="text"]'),t.id||(t.id=t.$input.data("ax6-formatter")),t.id||(t.id="ax6-formatter-"+_AX6UICore3.default.getInstanceId(),t.$input.data("ax6-formatter",t.id)),-1===(a=_AX6Util2.default.search(this.queue,function(){return this.id==t.id}))?(this.queue.push(t),bindFormatterTarget.call(this,this.queue[this.queue.length-1],this.queue.length-1)):(this.queue[a]=t,bindFormatterTarget.call(this,this.queue[a],a)),this}},{key:"formatting",value:function(){var t=_AX6Util2.default.isNumber(boundID)?boundID:getQueIdx.call(this,boundID);if(-1===t)for(var e=this.queue.length;e--;)formatterEvent.blur.call(this,this.queue[e],e,null,!0);else formatterEvent.blur.call(this,this.queue[t],t,null,!0);return this}},{key:"unbind",value:function(t){var e=this,r=void 0;if(!t.target)return console.log(_AX6Info2.default.getError("ax6formatter","401","unbind")),this;if(t.$target=(0,_jqmin2.default)(t.target),"INPUT"==t.$target.get(0).tagName)t.$input=t.$target;else if(t.$input=t.$target.find('input[type="text"]'),t.$input.length>1)return t.$input.each(function(){t.target=this,e.unbind(t)}),this;return t.$input="INPUT"==t.$target.get(0).tagName?t.$target:t.$target.find('input[type="text"]'),t.id=t.$input.data("ax6-formatter"),t.id&&(r=_AX6Util2.default.search(this.queue,function(){return this.id==t.id}),unbindFormatterTarget.call(this,this.queue[r]),this.queue.splice(r,1)),this}}],[{key:"setFormatter",value:function(t){return formatter=Object.assign(formatter,t)}},{key:"getFormatter",value:function(){return formatter||{}}},{key:"getCtrlKeys",value:function(){return _AX6UIFormatter_formatter2.default.ctrlKeys}},{key:"getNumKeys",value:function(){return _AX6UIFormatter_formatter2.default.numKeys}}]),e}();exports.default=AX6UIFormatter;
//# sourceMappingURL=AX6UIFormatter.js.map
