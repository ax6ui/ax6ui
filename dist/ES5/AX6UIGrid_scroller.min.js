"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(exports,"__esModule",{value:!0});var _jqmin=require("jqmin"),_jqmin2=_interopRequireDefault(_jqmin),_AX6Util=require("./AX6Util"),_AX6Util2=_interopRequireDefault(_AX6Util),_AX6Info=require("./AX6Info"),_AX6Info2=_interopRequireDefault(_AX6Info),_AX6UIGrid_util=require("./AX6UIGrid_util"),_AX6UIGrid_util2=_interopRequireDefault(_AX6UIGrid_util),_AX6UIGrid_header=require("./AX6UIGrid_header"),_AX6UIGrid_header2=_interopRequireDefault(_AX6UIGrid_header),_AX6UIGrid_body=require("./AX6UIGrid_body"),_AX6UIGrid_body2=_interopRequireDefault(_AX6UIGrid_body),moveout_timer=(new Date).getTime(),convertScrollPosition={vertical:function(t,i){var e=i._content_height-i._panel_height,l=i._vertical_scroller_height-i.verticalScrollBarHeight,r=e*t.top/l;return r<0?r=0:e<r&&(r=e),{top:-r}},horizontal:function(t,i){var e=i._content_width-i._panel_width,l=i._horizontal_scroller_width-i.horizontalScrollBarWidth,r=e*t.left/l;return r<0?r=0:e<r&&(r=e),{left:-r}}},convertScrollBarPosition={vertical:function(t,i){var e=this,l=i._content_height-i._panel_height,r=i._vertical_scroller_height-i.verticalScrollBarHeight,o=r*t/l,n=void 0;return-o>r&&(o=-r,n=convertScrollPosition.vertical.call(this,{top:-o},{_content_width:i._content_width,_content_height:i._content_height,_panel_width:i._panel_width,_panel_height:i._panel_height,_horizontal_scroller_width:i._horizontal_scroller_width,_vertical_scroller_height:i._vertical_scroller_height,verticalScrollBarHeight:i.verticalScrollBarHeight,horizontalScrollBarWidth:i.horizontalScrollBarWidth}),_AX6UIGrid_body2.default.scrollTo.call(e,n)),-o},horizontal:function(t,i){var e=this,l=i._content_width-i._panel_width,r=i._horizontal_scroller_width-i.horizontalScrollBarWidth,o=r*t/l,n=void 0;return-o>r&&(o=-r,n=convertScrollPosition.horizontal.call(this,{left:-o},{_content_width:i._content_width,_content_height:i._content_height,_panel_width:i._panel_width,_panel_height:i._panel_height,_horizontal_scroller_width:i._horizontal_scroller_width,_vertical_scroller_height:i._vertical_scroller_height,verticalScrollBarHeight:i.verticalScrollBarHeight,horizontalScrollBarWidth:i.horizontalScrollBarWidth}),_AX6UIGrid_header2.default.scrollTo.call(e,n),_AX6UIGrid_body2.default.scrollTo.call(e,n)),-o}},scrollBarMover={click:function(t,i,e,l){if((new Date).getTime()-moveout_timer<20)return!1;var r=this,o=t.offset(),n={width:i.outerWidth(),height:i.outerHeight()},a={width:t.innerWidth(),height:t.innerHeight()},h=r.$.scroller.vertical.innerHeight(),c=r.$.panel.body.height(),s=r.$.scroller.horizontal.innerWidth(),_=r.$.panel.body.width(),d=r.xvar.scrollContentHeight,u=r.xvar.scrollContentWidth,v=r.$.scroller["vertical-bar"].outerHeight(),f=r.$.scroller["horizontal-bar"].outerWidth(),g={vertical:function(t){var i=_AX6UIGrid_util2.default.getMousePosition(t).clientY-o.top;return i<0?i=0:i+n.height>a.height&&(i=a.height-n.height),{top:i}},horizontal:function(t){var i=_AX6UIGrid_util2.default.getMousePosition(t).clientX-o.left;return i<0?i=0:i+n.width>a.width&&(i=a.width-n.width),{left:i}}}[e](l);i.css(g);var p=convertScrollPosition[e].call(r,g,{_content_width:u,_content_height:d,_panel_width:_,_panel_height:c,_horizontal_scroller_width:s,_vertical_scroller_height:h,verticalScrollBarHeight:v,horizontalScrollBarWidth:f});"horizontal"===e&&_AX6UIGrid_header2.default.scrollTo.call(r,p),_AX6UIGrid_body2.default.scrollTo.call(r,p),p=null},on:function(t,i,e,l){var r=this,o=i.position(),n={width:i.outerWidth(),height:i.outerHeight()},a={width:t.innerWidth(),height:t.innerHeight()},h=r.$.scroller.vertical.innerHeight(),c=r.$.panel.body.height(),s=r.$.scroller.horizontal.innerWidth(),_=r.$.panel.body.width(),d=r.xvar.scrollContentHeight,u=r.xvar.scrollContentWidth,v=r.$.scroller["vertical-bar"].outerHeight(),f=r.$.scroller["horizontal-bar"].outerWidth(),g={vertical:function(t){var i=_AX6UIGrid_util2.default.getMousePosition(t);r.xvar.__da=i.clientY-r.xvar.mousePosition.clientY;var e=o.top+r.xvar.__da;return e<0?e=0:e+n.height>a.height&&(e=a.height-n.height),{top:e}},horizontal:function(t){var i=_AX6UIGrid_util2.default.getMousePosition(t);r.xvar.__da=i.clientX-r.xvar.mousePosition.clientX;var e=o.left+r.xvar.__da;return e<0?e=0:e+n.width>a.width&&(e=a.width-n.width),{left:e}}};r.xvar.__da=0,(0,_jqmin2.default)(document.body).on(_AX6UIGrid_util2.default.ENM.mousemove+".ax6grid-"+this.instanceId,function(t){var l=g[e](t);i.css(l);var o=convertScrollPosition[e].call(r,l,{_content_width:u,_content_height:d,_panel_width:_,_panel_height:c,_horizontal_scroller_width:s,_vertical_scroller_height:h,verticalScrollBarHeight:v,horizontalScrollBarWidth:f});"horizontal"===e&&_AX6UIGrid_header2.default.scrollTo.call(r,o),_AX6UIGrid_body2.default.scrollTo.call(r,o)}).on(_AX6UIGrid_util2.default.ENM.mouseup+".ax6grid-"+this.instanceId,function(t){scrollBarMover.off.call(r)}).on("mouseleave.ax6grid-"+this.instanceId,function(t){scrollBarMover.off.call(r)}),(0,_jqmin2.default)(document.body).attr("unselectable","on").css("user-select","none").on("selectstart",!1)},off:function(){moveout_timer=(new Date).getTime(),(0,_jqmin2.default)(document.body).off(_AX6UIGrid_util2.default.ENM.mousemove+".ax6grid-"+this.instanceId).off(_AX6UIGrid_util2.default.ENM.mouseup+".ax6grid-"+this.instanceId).off("mouseleave.ax6grid-"+this.instanceId),(0,_jqmin2.default)(document.body).removeAttr("unselectable").css("user-select","auto").off("selectstart")}},scrollContentMover={wheel:function(t){var i=this,e=i.$.panel["body-scroll"].position(),l=i.xvar.body_panel_height,r=i.xvar.body_panel_width,o=i.xvar.scrollContentHeight,n=i.xvar.scrollContentWidth;if(isNaN(o)||isNaN(n))return!1;var a=void 0,h=void 0,c=!1,s=!1;return a=e.left-t.x,(h=e.top-t.y)>=0?(h=0,c=!0):h<=l-o?((h=l-o)>=0&&(h=0),c=!0):0==t.y&&(c=!0),a>=0?(a=0,s=!0):a<=r-n?((a=r-n)>=0&&(a=0),s=!0):0==t.x&&(s=!0),_AX6UIGrid_header2.default.scrollTo.call(i,{left:a}),_AX6UIGrid_body2.default.scrollTo.call(i,{left:a,top:h},{callback:function(){resize.call(i)}}),!c||!s},on:function(){var t=this,i=t.$.panel["body-scroll"].position(),e=t.xvar.body_panel_height,l=t.xvar.body_panel_width,r=t.xvar.scrollContentHeight,o=t.xvar.scrollContentWidth,n=function(n){var a=_AX6UIGrid_util2.default.getMousePosition(n),h=void 0,c=void 0;return t.xvar.__x_da=a.clientX-t.xvar.mousePosition.clientX,t.xvar.__y_da=a.clientY-t.xvar.mousePosition.clientY,h=i.left+t.xvar.__x_da,(c=i.top+t.xvar.__y_da)>=0?c=0:c<=e-r&&(c=e-r)>=0&&(c=0),h>=0?h=0:h<=l-o&&(h=l-o)>=0&&(h=0),{left:h,top:c}};this.xvar.__x_da=0,this.xvar.__y_da=0,this.xvar.touchmoved=!1,(0,_jqmin2.default)(document.body).on("touchmove.ax6grid-"+this.instanceId,function(i){var e=n(i);resize.call(t),_AX6UIGrid_header2.default.scrollTo.call(t,{left:e.left}),_AX6UIGrid_body2.default.scrollTo.call(t,e,{noRepaint:"noRepaint"}),_AX6Util2.default.stopEvent(i.originalEvent),t.xvar.touchmoved=!0}).on("touchend.ax6grid-"+this.instanceId,function(i){if(t.xvar.touchmoved){var e=n(i);resize.call(t),_AX6UIGrid_header2.default.scrollTo.call(t,{left:e.left}),_AX6UIGrid_body2.default.scrollTo.call(t,e),_AX6Util2.default.stopEvent(i.originalEvent),scrollContentMover.off.call(t)}}),(0,_jqmin2.default)(document.body).attr("unselectable","on").css("user-select","none").on("selectstart",!1)},off:function(){(0,_jqmin2.default)(document.body).off("touchmove.ax6grid-"+this.instanceId).off("touchend.ax6grid-"+this.instanceId),(0,_jqmin2.default)(document.body).removeAttr("unselectable").css("user-select","auto").off("selectstart")}},init=function(){var t=this,i=this.config.scroller.trackPadding;0==i?(this.$.scroller["vertical-bar"].css({width:this.config.scroller.size,left:-1}),this.$.scroller["horizontal-bar"].css({height:this.config.scroller.size,top:-1})):(this.$.scroller["vertical-bar"].css({width:this.config.scroller.size-(i+1),left:i/2}),this.$.scroller["horizontal-bar"].css({height:this.config.scroller.size-(i+1),top:i/2})),this.$.scroller["vertical-bar"].on(_AX6UIGrid_util2.default.ENM.mousedown,function(t){this.xvar.mousePosition=_AX6UIGrid_util2.default.getMousePosition(t),scrollBarMover.on.call(this,this.$.scroller.vertical,this.$.scroller["vertical-bar"],"vertical",t)}.bind(this)).on("dragstart",function(t){return _AX6Util2.default.stopEvent(t),!1}),this.$.scroller.vertical.on("click",function(t){"vertical"==t.target.getAttribute("data-ax6grid-scroller")&&scrollBarMover.click.call(this,this.$.scroller.vertical,this.$.scroller["vertical-bar"],"vertical",t)}.bind(this)),this.$.scroller["horizontal-bar"].on(_AX6UIGrid_util2.default.ENM.mousedown,function(t){this.xvar.mousePosition=_AX6UIGrid_util2.default.getMousePosition(t),scrollBarMover.on.call(this,this.$.scroller.horizontal,this.$.scroller["horizontal-bar"],"horizontal",t)}.bind(this)).on("dragstart",function(t){return _AX6Util2.default.stopEvent(t),!1}),this.$.scroller.horizontal.on("click",function(t){"horizontal"==t.target.getAttribute("data-ax6grid-scroller")&&scrollBarMover.click.call(this,this.$.scroller.horizontal,this.$.scroller["horizontal-bar"],"horizontal",t)}.bind(this)),this.$.container.body.on("mousewheel DOMMouseScroll",function(t){var i=t.originalEvent,e={x:0,y:0};i.detail?e.y=10*i.detail:void 0===i.deltaY?(e.y=-i.wheelDelta,e.x=0):(e.y=i.deltaY,e.x=i.deltaX),scrollContentMover.wheel.call(this,e)&&_AX6Util2.default.stopEvent(t)}.bind(this)),_AX6Info2.default.supportTouch&&this.$.container.body.on("touchstart","[data-ax6grid-panel]",function(i){t.xvar.mousePosition=_AX6UIGrid_util2.default.getMousePosition(i),scrollContentMover.on.call(t)}),this.xvar.body_panel_height=this.$.panel.body.height(),this.xvar.body_panel_width=this.$.panel.body.width()},resize=function(){var t=this.$.scroller.vertical.height(),i=this.$.scroller.horizontal.width(),e=this.$.panel.body.height(),l=this.$.panel.body.width(),r=this.xvar.scrollContentHeight,o=this.xvar.scrollContentWidth,n=e*t/r,a=l*i/o;n<this.config.scroller.barMinSize&&(n=this.config.scroller.barMinSize),a<this.config.scroller.barMinSize&&(a=this.config.scroller.barMinSize),this.$.scroller["vertical-bar"].css({top:convertScrollBarPosition.vertical.call(this,this.$.panel["body-scroll"].position().top,{_content_width:o,_content_height:r,_panel_width:l,_panel_height:e,_horizontal_scroller_width:i,_vertical_scroller_height:t,verticalScrollBarHeight:n,horizontalScrollBarWidth:a}),height:n}),this.$.scroller["horizontal-bar"].css({left:convertScrollBarPosition.horizontal.call(this,this.$.panel["body-scroll"].position().left,{_content_width:o,_content_height:r,_panel_width:l,_panel_height:e,_horizontal_scroller_width:i,_vertical_scroller_height:t,verticalScrollBarHeight:n,horizontalScrollBarWidth:a}),width:a}),this.xvar.body_panel_height=e,this.xvar.body_panel_width=l,t=null,i=null,e=null,l=null,r=null,o=null,n=null,a=null};exports.default={moveout_timer:moveout_timer,init:init,resize:resize};
//# sourceMappingURL=AX6UIGrid_scroller.js.map
