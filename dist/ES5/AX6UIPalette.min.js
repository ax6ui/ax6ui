"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var l=t[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,o,l){return o&&e(t.prototype,o),l&&e(t,l),t}}(),_jqmin=require("jqmin"),_jqmin2=_interopRequireDefault(_jqmin),_AX6UICore2=require("./AX6UICore"),_AX6UICore3=_interopRequireDefault(_AX6UICore2),_AX6Info=require("./AX6Info"),_AX6Info2=_interopRequireDefault(_AX6Info),_AX6Util=require("./AX6Util"),_AX6Util2=_interopRequireDefault(_AX6Util),_AX6Mustache=require("./AX6Mustache"),_AX6Mustache2=_interopRequireDefault(_AX6Mustache);require("./AX6UIPalette/index.scss");var frameTmpl=function(e){return'\n<div data-ax6ui-palette="">\n<div data-ax6palette-container="root">\n    <div data-ax6palette-container="colors"></div>\n    <div data-ax6palette-container="controls"></div>\n</div>\n</div>\n'},colorsTmpl=function(e){return'\n{{#colors}}\n{{#list}}\n<div data-ax6palette-color="{{label}}" data-ax6palette-color-index="{{@i}}">\n    <div data-panel="color-preview" style="padding:{{preview.cellPadding}}px;width:{{preview.cellWidth}}px;">\n        <div data-panel="color-box" style="width:{{preview.width}}px;height:{{preview.height}}px;"><div data-panel="color" style="background-color:{{value}};"></div></div>\n    </div>\n    <div data-panel="color-label" style="width:{{label.width}}px;">{{label}}</div>\n    <div data-panel="color-slider">\n        <div data-panel="color-track" style="height:{{slider.trackHeight}}px;background: linear-gradient(90deg, {{_color0value}}, {{_color1value}}, {{_color2value}}); ">\n            <div data-panel="color-handle">\n                <div data-panel="color-handle-after" style="width:{{slider.handleWidth}}px;height:{{slider.handleWidth}}px;left:{{slider.handleLeft}}px;top:{{slider.handleLeft}}px;"></div>\n            </div>\n        </div>\n    </div>\n</div>\n{{/list}}\n{{/colors}}\n'},ENM={mousedown:_AX6Info2.default.supportTouch?"touchstart":"mousedown",mousemove:_AX6Info2.default.supportTouch?"touchmove":"mousemove",mouseup:_AX6Info2.default.supportTouch?"touchend":"mouseup"},onStateChanged=function(e,t){e&&e.onStateChanged?e.onStateChanged.call(t,t):this.onStateChanged&&this.onStateChanged.call(t,t),t=null},getMousePosition=function(e){var t=void 0,o=e.originalEvent?e.originalEvent:e;return t="changedTouches"in o&&o.changedTouches?o.changedTouches[0]:o,{clientX:t.pageX,clientY:t.pageY}},bindHandle=function(e){var t=this;e.originalTrackWidth=e.$track.width(),e.trackWidth=e.originalTrackWidth-this.config.colors.slider.handleWidth/5;var o=amountToHandleLeft.call(this,e,e._amount);if(o<0||o>e.trackWidth){var l=void 0;o=o<0?0:o>e.trackWidth?e.trackWidth:o,l=handleLeftToAmount.call(this,e,o),updatePreviewColor.call(this,e,amountToColor.call(this,e,l))}e.$handle.css({left:o}),e.$item.off(ENM.mousedown).on(ENM.mousedown,'[data-panel="color-handle"]',function(o){var l=getMousePosition(o);e._originalHandleClientX=l.clientX,e._originalHandleLeft=e.$handle.position().left,handleMoveEvent.on.call(t,e),_AX6Util2.default.stopEvent(o.originalEvent)}).off("click").on("click",'[data-panel="color-label"], [data-panel="color-preview"]',function(o){t.onClick&&t.onClick.call(e,"#"+e._selectedColor.toUpperCase(),o)}).on("click",'[data-panel="color-track"]',function(o){if("color-track"==o.target.getAttribute("data-panel")){var l=getMousePosition(o),n=l.clientX-e.$track.offset().left,a=handleLeftToAmount(e,n);e.$handle.css({left:n}),updatePreviewColor.call(t,e,amountToColor.call(t,e,a),o),l=null,n=null,a=null}})},updatePreviewColor=function(e,t,o){e.$preview.css({"background-color":"#"+t}),e.$label.html("#"+t.toUpperCase()),e._selectedColor=t,o&&this.onUpdateColor&&this.onUpdateColor.call(e,"#"+e._selectedColor.toUpperCase())},amountToColor=function(e,t){var o={black:function(e,t){return e.lighten(this.config.colors.slider.amount/2).darken(t).getHexValue()},white:function(e,t){return e.darken(this.config.colors.slider.amount/2).darken(t).getHexValue()},normal:function(e,t){return e.darken(t).getHexValue()}};return e._uniqColor in o?o[e._uniqColor].call(this,e._color,t):o.normal.call(this,e._color,t)},colorToAmount=function(e,t){var o={black:function(e,t){return 100*(e.lighten(this.config.colors.slider.amount/2).getHsl().l-t.getHsl().l)},white:function(e,t){return 100*(e.darken(this.config.colors.slider.amount/2).getHsl().l-t.getHsl().l)},normal:function(e,t){return 100*(e.getHsl().l-t.getHsl().l)}};return e._uniqColor in o?o[e._uniqColor].call(this,e._color,t):o.normal.call(this,e._color,t)},handleLeftToAmount=function(e,t){return this.config.colors.slider.amount*(t-e.trackWidth/2)/(e.originalTrackWidth/2)},amountToHandleLeft=function(e,t){return t*(e.originalTrackWidth/2)/this.config.colors.slider.amount+e.trackWidth/2},handleMoveEvent={on:function(e){var t=this;(0,_jqmin2.default)(document.body).on(ENM.mousemove+".ax6palette-"+this.instanceId,function(o){var l=getMousePosition(o),n=l.clientX-e._originalHandleClientX,a=e._originalHandleLeft+n,i=void 0;a=a<0?0:a>e.trackWidth?e.trackWidth:a,e.$handle.css({left:a}),i=handleLeftToAmount.call(t,e,a),updatePreviewColor.call(t,e,amountToColor.call(t,e,i),o),l=null,n=null}).on(ENM.mouseup+".ax6palette-"+this.instanceId,function(e){handleMoveEvent.off.call(t),_AX6Util2.default.stopEvent(e)}).on("mouseleave.ax6palette-"+this.instanceId,function(e){handleMoveEvent.off.call(t),_AX6Util2.default.stopEvent(e)}),(0,_jqmin2.default)(document.body).attr("unselectable","on").css("user-select","none").on("selectstart",!1)},off:function(){this.xvar.resizerLived=!1,(0,_jqmin2.default)(document.body).off(ENM.mousemove+".ax6palette-"+this.instanceId).off(ENM.mouseup+".ax6palette-"+this.instanceId).off("mouseleave.ax6palette-"+this.instanceId),(0,_jqmin2.default)(document.body).removeAttr("unselectable").css("user-select","auto").off("selectstart")}},_repaint=function(e){var t=this;this.$target.innerWidth(),this.$target.innerHeight();this.$target.html(_AX6Mustache2.default.render(frameTmpl.call(this),{},this.config.columnKeys)),this.$={root:this.$target.find('[data-ax6palette-container="root"]'),colors:this.$target.find('[data-ax6palette-container="colors"]'),controls:this.$target.find('[data-ax6palette-container="controls"]')},this.config.colors.list.forEach(function(e){e._color=_AX6Util2.default.color(e.value),e._selectedColor=e._color.getHexValue(),0==e._color.r&&0==e._color.g&&0==e._color.b?(e._amount=t.config.colors.slider.amount,e._uniqColor="black",e._color0value="#"+e._color.lighten(t.config.colors.slider.amount).getHexValue(),e._color1value="#"+e._color.lighten(t.config.colors.slider.amount/2).getHexValue(),e._color2value="#"+e._color.getHexValue()):255==e._color.r&&255==e._color.g&&255==e._color.b?(e._amount=-t.config.colors.slider.amount,e._uniqColor="white",e._color0value="#"+e._color.getHexValue(),e._color1value="#"+e._color.darken(t.config.colors.slider.amount/2).getHexValue(),e._color2value="#"+e._color.darken(t.config.colors.slider.amount).getHexValue()):(e._amount=0,e._color0value="#"+e._color.lighten(t.config.colors.slider.amount).getHexValue(),e._color1value="#"+e._color.getHexValue(),e._color2value="#"+e._color.darken(t.config.colors.slider.amount).getHexValue())}),this.config.colors.slider.handleLeft=-this.config.colors.slider.handleWidth/2,this.config.colors.slider.handleTop=-this.config.colors.slider.handleHeight/2,this.$.colors.html(_AX6Mustache2.default.render(colorsTmpl.call(this),this.config,this.config.columnKeys)),this.$.colors.find("[data-ax6palette-color-index]").each(function(e,o){var l=o.getAttribute("data-ax6palette-color-index"),n=t.config.colors.list[l],a=_jqmin2.default.extend({},n);a._index=l,a.$item=(0,_jqmin2.default)(o),a.$preview=a.$item.find('[data-panel="color"]'),a.$label=a.$item.find('[data-panel="color-label"]'),a.$track=a.$item.find('[data-panel="color-track"]'),a.$handle=a.$item.find('[data-panel="color-handle"]'),bindHandle.call(t,a),t.colors.push(a)}),e&&this.setSelectedColor(e)},AX6UIPalette=function(e){function t(e){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.config={clickEventName:"click",theme:"default",animateTime:100,colors:{preview:{width:24,height:24,cellWidth:30},label:{width:80},slider:{trackHeight:8,amount:32,handleWidth:18,handleHeight:18},list:[{label:"red",value:"#ff0000"},{label:"orange",value:"#ff9802"},{label:"yellow",value:"#ffff00"},{label:"green",value:"#00ff36"},{label:"blue",value:"#0000ff"},{label:"purple",value:"#ba00ff"},{label:"black",value:"#000000"},{label:"white",value:"#ffffff"}]},controls:{height:0},columnKeys:{}},_jqmin2.default.extend(!0,o.config,e),o.$target=null,o.xvar={},o.colors=[],o.init(),o}return _inherits(t,_AX6UICore3.default),_createClass(t,[{key:"init",value:function(){var e=this;this.onStateChanged=this.config.onStateChanged,delete this.config.onStateChanged,this.onClick=this.config.onClick,delete this.config.onClick,this.onUpdateColor=this.config.onUpdateColor,delete this.config.onUpdateColor,this.config.target||console.log(_AX6Info2.default.getError("ax6palette","401","setConfig")),this.$target=(0,_jqmin2.default)(this.config.target),setTimeout(function(){_repaint.call(e,(e.config.selectedColor||"").trim())}),this.initOnce()}},{key:"initOnce",value:function(){if(this.initialized)return this;this.initialized=!0}},{key:"repaint",value:function(){return _repaint.call(this),this}},{key:"setSelectedColor",value:function(e){var t=_AX6Util2.default.color(e.trim()),o=765,l=-1;if(this.colors.forEach(function(e,n){var a=e._color.getHsl(),i=t.getHsl(),r=Math.abs(a.h-i.h)+Math.abs(a.s-i.s)+Math.abs(a.l-i.l);r<o&&(o=r,l=n)}),l>-1){var n=void 0,a=void 0,i=this.colors[l];i._amount=colorToAmount.call(this,i,t),a=amountToHandleLeft.call(this,i,i._amount),i.$handle.css({left:a}),n=handleLeftToAmount.call(this,i,a),updatePreviewColor.call(this,i,amountToColor.call(this,i,n))}return this}}]),t}();exports.default=AX6UIPalette;
//# sourceMappingURL=AX6UIPalette.js.map
