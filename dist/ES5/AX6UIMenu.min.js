"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_jqmin=require("jqmin"),_jqmin2=_interopRequireDefault(_jqmin),_AX6UICore2=require("./AX6UICore.js"),_AX6UICore3=_interopRequireDefault(_AX6UICore2),_AX6Info=require("./AX6Info"),_AX6Info2=_interopRequireDefault(_AX6Info),_AX6Util=require("./AX6Util"),_AX6Util2=_interopRequireDefault(_AX6Util),_AX6Mustache=require("./AX6Mustache"),_AX6Mustache2=_interopRequireDefault(_AX6Mustache);require("./AX6UIMenu/index.scss");var tmpl={menu:function(e){return'\n        <div data-ax6ui-menu="" class="{{theme}}" {{#width}}style="width:{{width}}px;"{{/width}}>\n            <div class="ax-menu-body">\n                {{#'+e.items+'}}\n                    {{^@isMenu}}\n                        {{#divide}}\n                        <div class="ax-menu-item-divide" data-menu-item-index="{{@i}}"></div>\n                        {{/divide}}\n                        {{#html}}\n                        <div class="ax-menu-item-html" data-menu-item-index="{{@i}}">{{{@html}}}</div>\n                        {{/html}}\n                    {{/@isMenu}}\n                    {{#@isMenu}}\n                    <div class="ax-menu-item" data-menu-item-depth="{{@depth}}" data-menu-item-index="{{@i}}" data-menu-item-path="{{@path}}.{{@i}}">\n                        <span class="ax-menu-item-cell ax-menu-item-checkbox">\n                            {{#check}}\n                            <span class="item-checkbox-wrap useCheckBox" {{#checked}}data-item-checked="true"{{/checked}}></span>\n                            {{/check}}\n                            {{^check}}\n                            <span class="item-checkbox-wrap"></span>\n                            {{/check}}\n                        </span>\n                        {{#icon}}\n                        <span class="ax-menu-item-cell ax-menu-item-icon" style="width:{{cfg.iconWidth}}px;">{{{.}}}</span>\n                        {{/icon}}\n                        <span class="ax-menu-item-cell ax-menu-item-label">{{{'+e.label+'}}}</span>\n                        {{#accelerator}}\n                        <span class="ax-menu-item-cell ax-menu-item-accelerator" style="width:{{cfg.acceleratorWidth}}px;"><span class="item-wrap">{{.}}</span></span>\n                        {{/accelerator}}\n                        {{#@hasChild}}\n                        <span class="ax-menu-item-cell ax-menu-item-handle">{{{cfg.icons.arrow}}}</span>\n                        {{/@hasChild}}\n                    </div>\n                    {{/@isMenu}}\n\n                {{/'+e.items+'}}\n            </div>\n            <div class="ax-menu-arrow"></div>\n        </div>\n        '},menubar:function(e){return'\n        <div data-ax6ui-menubar="" class="{{theme}}">\n            <div class="ax-menu-body">\n                {{#'+e.items+'}}\n                    {{^@isMenu}}\n                        {{#divide}}\n                        <div class="ax-menu-item-divide" data-menu-item-index="{{@i}}"></div>\n                        {{/divide}}\n                        {{#html}}\n                        <div class="ax-menu-item-html" data-menu-item-index="{{@i}}">{{{@html}}}</div>\n                        {{/html}}\n                    {{/@isMenu}}\n                    {{#@isMenu}}\n                    <div class="ax-menu-item" data-menu-item-index="{{@i}}">\n                        {{#icon}}\n                        <span class="ax-menu-item-cell ax-menu-item-icon" style="width:{{cfg.iconWidth}}px;">{{{.}}}</span>\n                        {{/icon}}\n                        <span class="ax-menu-item-cell ax-menu-item-label">{{{'+e.label+"}}}</span>\n                    </div>\n                    {{/@isMenu}}\n                {{/"+e.items+"}}\n            </div>\n        </div>\n        "}},appEventAttach=function(e,t){e?((0,_jqmin2.default)(document.body).off("click.ax5menu-"+this.instanceId).on("click.ax5menu-"+this.instanceId,clickItem.bind(this,t)),(0,_jqmin2.default)(window).off("keydown.ax5menu-"+this.instanceId).on("keydown.ax5menu-"+this.instanceId,function(e){e.which==_AX6Info2.default.eventKeys.ESC&&self.close()}).off("resize.ax5menu-"+this.instanceId).on("resize.ax5menu-"+this.instanceId,function(e){self.close()})):((0,_jqmin2.default)(document.body).off("click.ax5menu-"+this.instanceId),(0,_jqmin2.default)(window).off("keydown.ax5menu-"+this.instanceId),(0,_jqmin2.default)(window).off("resize.ax5menu-"+this.instanceId))},onStateChanged=function(e,t){return e&&e.onStateChanged?e.onStateChanged.call(t,t):this.onStateChanged&&this.onStateChanged.call(t,t),this.state=t.state,e=null,t=null,!0},onLoad=function(e){return this.onLoad&&this.onLoad.call(e,e),e=null,!0},_popup=function e(t,n,i,a){var l=this,u=this.config,o=t,c=void 0;return o.theme=t.theme||u.theme,o.cfg={icons:_jqmin2.default.extend({},u.icons),iconWidth:t.iconWidth||u.iconWidth,acceleratorWidth:t.acceleratorWidth||u.acceleratorWidth},n.forEach(function(e){e.html||e.divide?(e["@isMenu"]=!1,e.html&&(e["@html"]=e.html.call({item:e,config:u,opt:t}))):e["@isMenu"]=!0}),o[u.columnKeys.items]=n,o["@depth"]=i,o["@path"]=a||"root",o["@hasChild"]=function(){return this[u.columnKeys.items]&&this[u.columnKeys.items].length>0},c=(0,_jqmin2.default)(_AX6Mustache2.default.render(tmpl.menu.call(this,u.columnKeys),o)),(0,_jqmin2.default)(document.body).append(c),this.queue.splice(i).forEach(function(e){e.$target.remove()}),this.queue.push({$target:c,data:_jqmin2.default.extend({},o)}),c.on("mouseover","[data-menu-item-index]",function(){var n=this.getAttribute("data-menu-item-depth"),i=this.getAttribute("data-menu-item-index"),a=this.getAttribute("data-menu-item-path"),o=void 0,c=void 0,s=void 0,r=void 0,d=void 0,m=void 0;null!=n&&void 0!==n&&(d=l.queue[n].data[u.columnKeys.items][i][u.columnKeys.items],(m=l.queue[n].$target).find("[data-menu-item-index]").removeClass("hover"),(0,_jqmin2.default)(this).addClass("hover"),m.attr("data-selected-menu-item-index")!=i&&(m.attr("data-selected-menu-item-index",i),d&&d.length>0?(c=(o=(0,_jqmin2.default)(this)).offset(),s="fixed"==u.position?(0,_jqmin2.default)(document).scrollTop():0,r={"@parent":{left:c.left,top:c.top,width:o.outerWidth(),height:o.outerHeight()},left:c.left+o.outerWidth()-u.menuBodyPadding,top:c.top-u.menuBodyPadding-1-s},r=_jqmin2.default.extend(!0,t,r),e.call(l,r,d,Number(n)+1,a)):l.queue.splice(Number(n)+1).forEach(function(e){e.$target.remove()}))),n=null,i=null,a=null,o=null,c=null,s=null,r=null,d=null,m=null}),c.on("mouseout","[data-menu-item-index]",function(){var e=this.getAttribute("data-menu-item-depth"),t=this.getAttribute("data-menu-item-index"),n=void 0;this.getAttribute("data-menu-item-path")&&(n=l.queue[e].data[u.columnKeys.items][t][u.columnKeys.items]),n&&n.length>0||(0,_jqmin2.default)(this).removeClass("hover")}),0==i&&(o.direction&&c.addClass("direction-"+o.direction),onStateChanged.call(this,null,{self:this,items:n,parent:function(e){if(!e)return!1;try{return Function("","return this.config.items["+e.substring(5).replace(/\./g,"].items[")+"];").call(l)}catch(e){}}(o["@path"]),state:"popup"})),align.call(this,c,o),onLoad.call(this,{self:this,items:n,element:c.get(0)}),o=null,c=null,null,t=null,n=null,i=null,a=null,this},clickItem=function(e,t){var n=this,i=this.config,a=void 0,l=void 0;if(a=_AX6Util2.default.findParentNode(t.target,function(e){if(e.getAttribute("data-menu-item-index"))return!0})){if(void 0===e&&(e={}),!(l=function(t){if(!t)return!1;try{return Function("","return this["+t.substring(5).replace(/\./g,"]."+i.columnKeys.items+"[")+"];").call(e.items||i.items)}catch(e){console.log(_AX6Info2.default.getError("ax5menu","501","menuItemClick"))}finally{l=null}}(a.getAttribute("data-menu-item-path"))))return this;l.check&&(function(e){var t={checkbox:function(e){this.checked=!e},radio:function(t){var n=this.name;e.forEach(function(e){e.check&&"radio"===e.check.type&&e.check.name==n&&(e.check.checked=!1)}),this.checked=!t}};t[this.type]&&t[this.type].call(this,this.checked),t=null}.call(l.check,i.items),i.itemClickAndClose||n.queue.forEach(function(e){e.$target.find("[data-menu-item-index]").each(function(){var t=e.data[i.columnKeys.items][this.getAttribute("data-menu-item-index")];t.check&&(0,_jqmin2.default)(this).find(".item-checkbox-wrap").attr("data-item-checked",t.check.checked),t=null})})),n.onClick&&n.onClick.call(l,l,e.param)&&n.close(),l[i.columnKeys.items]&&0!=l[i.columnKeys.items].length||!i.itemClickAndClose||n.close()}else n.close();return a=null,l=null,this},align=function(e,t){var n=this.config,i=(0,_jqmin2.default)(window),a=(0,_jqmin2.default)(document),l="fixed"==n.position?i.height():a.height(),u=i.width(),o=e.outerHeight(),c=e.outerWidth(),s=t.left,r=t.top,d=n.position||"fixed";return s+c>u&&(s=t["@parent"]?t["@parent"].left-c+n.menuBodyPadding:u-c),r+o>l&&(r=l-o),e.css({left:s,top:r,position:d}),e=null,t=null,i=null,a=null,l=null,u=null,o=null,c=null,s=null,r=null,d=null,this},AX6UIMenu=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.config={theme:"default",iconWidth:22,acceleratorWidth:100,menuBodyPadding:5,offset:{left:0,top:0},position:"fixed",animateTime:250,items:[],itemClickAndClose:!0,columnKeys:{label:"label",items:"items"}},_jqmin2.default.extend(!0,n.config,e),n.openTimer=null,n.closeTimer=null,n.queue=[],n.menuBar={},n.state=void 0,void 0!==e&&n.init(),n}return _inherits(t,_AX6UICore3.default),_createClass(t,[{key:"init",value:function(){this.onStateChanged=this.config.onStateChanged,delete this.config.onStateChanged,this.onClick=this.config.onClick,delete this.config.onClick,this.onLoad=this.config.onLoad,delete this.config.onLoad,onStateChanged.call(this,null,{self:this,state:"init"}),this.initOnce()}},{key:"initOnce",value:function(){if(this.initialized)return this;this.initialized=!0}},{key:"popup",value:function(e,t){var n=this.config,i={event:function(e,t){(e={left:e.clientX,top:"fixed"==n.position?e.clientY:e.pageY,width:n.width,theme:n.theme}).left-=5,e.top-=5,n.offset&&(n.offset.left&&(e.left+=n.offset.left),n.offset.top&&(e.top+=n.offset.top)),t=_jqmin2.default.extend(!0,e,t);try{return t}finally{e=null}},object:function(e,t){e={left:e.left,top:e.top,width:e.width||n.width,theme:e.theme||n.theme},n.offset&&(n.offset.left&&(e.left+=n.offset.left),n.offset.top&&(e.top+=n.offset.top)),t=_jqmin2.default.extend(!0,e,t);try{return t}finally{e=null}}};if(!e)return this;!function(e){e&&(n.theme=e)}((t=i[void 0===e.clientX?"object":"event"].call(this,e,t)).theme);var a=[].concat(n.items),l=void 0;return t.items=a,t.filter&&(l=function(e){var n=[];return e.forEach(function(e){e.items&&e.items.length>0&&(e.items=l(e.items)),t.filter.call(e)&&n.push(e)}),n},t.items=a=l(a)),a.length&&(appEventAttach.call(this,!1),_popup.call(this,t,a,0),this.popupEventAttachTimer&&clearTimeout(this.popupEventAttachTimer),this.popupEventAttachTimer=setTimeout(function(){appEventAttach.call(this,!0,t)}.bind(this),500)),e=null,this}},{key:"attach",value:function(e,t){var n=this,i=this.config,a={object:function(e,t){e={left:e.left,top:e.top,width:e.width||i.width,theme:e.theme||i.theme,direction:e.direction||i.direction},t=_jqmin2.default.extend(!0,t,e);try{return t}finally{e=null,t=null}}},l=function(e,t,l){var u=(0,_jqmin2.default)(e),o=u.offset(),c=u.outerHeight(),s=Number(e.getAttribute("data-menu-item-index")),r="fixed"==i.position?(0,_jqmin2.default)(document).scrollTop():0;if(i.items&&i.items[s][i.columnKeys.items]&&i.items[s][i.columnKeys.items].length){if(n.menuBar.openedIndex==s)return"click"==l&&n.close(),!1;n.menuBar.target.find("[data-menu-item-index]").removeClass("hover"),n.menuBar.opened=!0,n.menuBar.openedIndex=s,u.attr("data-menu-item-opened","true"),u.addClass("hover"),i.offset&&(i.offset.left&&(o.left+=i.offset.left),i.offset.top&&(o.top+=i.offset.top)),t=a.object.call(this,{left:o.left,top:o.top+c-r},t),_popup.call(n,t,i.items[s][i.columnKeys.items],0,"root."+e.getAttribute("data-menu-item-index")),appEventAttach.call(n,!0,{})}e=null,t=null,u=null,o=null,c=null,s=null,r=null},u=function(e,t,a){var l=(0,_jqmin2.default)(e),u=(l.offset(),l.outerHeight(),Number(e.getAttribute("data-menu-item-index")));"fixed"==i.position&&(0,_jqmin2.default)(document).scrollTop();!i.items||i.items[u][i.columnKeys.items]&&0!=i.items[u][i.columnKeys.items].length||n.onClick&&n.onClick.call(i.items[u],i.items[u])},o={},c=i.items,s=void 0;return void 0===t&&(t={}),o.theme=t.theme||i.theme,o.cfg={icons:_jqmin2.default.extend({},i.icons),iconWidth:t.iconWidth||i.iconWidth,acceleratorWidth:t.acceleratorWidth||i.acceleratorWidth},c.forEach(function(e){e.html||e.divide?(e["@isMenu"]=!1,e.html&&(e["@html"]=e.html.call({item:e,config:i,opt:t}))):e["@isMenu"]=!0}),o[i.columnKeys.items]=c,s=(0,_jqmin2.default)(_AX6Mustache2.default.render(tmpl.menubar.call(this,i.columnKeys),o)),n.menuBar={target:(0,_jqmin2.default)(e),opened:!1},n.menuBar.target.html(s),n.menuBar.target.on("click",function(e){if(!e)return this;var n=_AX6Util2.default.findParentNode(e.target,function(e){if(e.getAttribute("data-menu-item-index"))return!0});n&&(u(n),l(n,t,"click")),n=null}),n.menuBar.target.on("mouseover",function(e){if(!n.menuBar.opened)return!1;var i=_AX6Util2.default.findParentNode(e.target,function(e){if(e.getAttribute("data-menu-item-index"))return!0});i&&l(i,t,"mouseover"),i=null}),e=null,t=null,o=null,c=null,s=null,this}},{key:"close",value:function(){var e=this;this.config;return e.menuBar&&e.menuBar.target&&(e.menuBar.target.find("[data-menu-item-index]").removeClass("hover"),e.menuBar.opened=!1,e.menuBar.openedIndex=null),appEventAttach.call(this,!1),this.queue.forEach(function(e){e.$target.remove()}),this.queue=[],onStateChanged.call(this,null,{self:this,state:"close"}),this}},{key:"getCheckValue",value:function(){var e={};!function t(n){for(var i=n.length;i--;)n[i].check&&n[i].check.checked&&(e[n[i].check.name]?(_AX6Util2.default.isString(e[n[i].check.name])&&(e[n[i].check.name]=[e[n[i].check.name]]),e[n[i].check.name].push(n[i].check.value)):e[n[i].check.name]=n[i].check.value),n[i].items&&n[i].items.length>0&&t(n[i].items)}(this.config.items);try{return e}finally{e=null}}}]),t}();exports.default=AX6UIMenu;
//# sourceMappingURL=AX6UIMenu.js.map
