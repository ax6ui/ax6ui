"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var l=t[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,i,l){return i&&e(t.prototype,i),l&&e(t,l),t}}(),_jqmin=require("jqmin"),_jqmin2=_interopRequireDefault(_jqmin),_AX6UICore2=require("./AX6UICore.js"),_AX6UICore3=_interopRequireDefault(_AX6UICore2),_AX6Util=require("./AX6Util"),_AX6Util2=_interopRequireDefault(_AX6Util),_AX6Info=require("./AX6Info"),_AX6Info2=_interopRequireDefault(_AX6Info),_AX6Mustache=require("./AX6Mustache.js"),_AX6Mustache2=_interopRequireDefault(_AX6Mustache);require("./AX6UIToast/index.scss");var ENM={mousedown:_AX6Info2.default.supportTouch?"touchstart":"mousedown",mousemove:_AX6Info2.default.supportTouch?"touchmove":"mousemove",mouseup:_AX6Info2.default.supportTouch?"touchend":"mouseup"},getMousePosition=function(e){var t=e;return"changedTouches"in e&&e.changedTouches&&(t=e.changedTouches[0]),{clientX:t.clientX,clientY:t.clientY}},onStateChanged=function(e,t){var i={resize:function(t){e&&e.onResize?e.onResize.call(t,t):this.onResize&&this.onResize.call(t,t)},move:function(){}};return t.state in i&&i[t.state].call(this,t),e&&e.onStateChanged?e.onStateChanged.call(t,t):this.onStateChanged&&this.onStateChanged.call(t,t),!0},getContent=function(e,t){var i={modalId:e,theme:t.theme,header:t.header,fullScreen:t.fullScreen?"fullscreen":"",styles:"",iframe:t.iframe,iframeLoadingMsg:t.iframeLoadingMsg,disableResize:t.disableResize};return t.zIndex&&(i.styles+="z-index:"+t.zIndex+";"),t.absolute&&(i.styles+="position:absolute;"),i.iframe&&"string"==typeof i.iframe.param&&(i.iframe.param=ax5.util.param(i.iframe.param)),MODAL.tmpl.get.call(this,"content",i,{})},open=function(e,t){var i=void 0;(0,_jqmin2.default)(document.body).append(getContent.call(this,e.id,e)),this.activeModal=(0,_jqmin2.default)("#"+e.id),this.$={root:this.activeModal,header:this.activeModal.find('[data-modal-els="header"]'),body:this.activeModal.find('[data-modal-els="body"]')},e.iframe?(this.$["iframe-wrap"]=this.activeModal.find('[data-modal-els="iframe-wrap"]'),this.$.iframe=this.activeModal.find('[data-modal-els="iframe"]'),this.$["iframe-form"]=this.activeModal.find('[data-modal-els="iframe-form"]'),this.$["iframe-loading"]=this.activeModal.find('[data-modal-els="iframe-loading"]')):this.$["body-frame"]=this.activeModal.find('[data-modal-els="body-frame"]'),this.align(),i={self:this,id:e.id,theme:e.theme,width:e.width,height:e.height,state:"open",$:this.$},e.iframe&&(this.$["iframe-wrap"].css({height:e.height}),this.$.iframe.css({height:e.height}),this.$["iframe-form"].attr({method:e.iframe.method}),this.$["iframe-form"].attr({target:e.id+"-frame"}),this.$["iframe-form"].attr({action:e.iframe.url}),this.$.iframe.on("load",function(){i.state="load",e.iframeLoadingMsg&&this.$["iframe-loading"].hide(),onStateChanged.call(this,e,i)}.bind(this)),e.iframeLoadingMsg||this.$.iframe.show(),this.$["iframe-form"].submit()),t&&t.call(i,i),this.watingModal||onStateChanged.call(this,e,i),e.closeToEsc&&(0,_jqmin2.default)(window).bind("keydown.ax-modal",function(e){onkeyup.call(this,e||window.event)}.bind(this)),(0,_jqmin2.default)(window).bind("resize.ax-modal",function(e){this.align(null,e||window.event)}.bind(this)),this.$.header.off(ENM.mousedown).off("dragstart").on(ENM.mousedown,function(t){var i=_AX6Util2.default.findParentNode(t.target,function(e){if(e.getAttribute("data-modal-header-btn"))return!0});e.isFullScreen||i||1==e.disableDrag||(self.mousePosition=getMousePosition(t),moveModal.on.call(self)),i&&btnOnClick.call(self,t||window.event,e)}).on("dragstart",function(e){return _AX6Util2.default.stopEvent(e.originalEvent),!1}),this.activeModal.off(ENM.mousedown).off("dragstart").on(ENM.mousedown,"[data-ax5modal-resizer]",function(t){if(e.disableDrag||e.isFullScreen)return!1;self.mousePosition=getMousePosition(t),resizeModal.on.call(self,this.getAttribute("data-ax5modal-resizer"))}).on("dragstart",function(e){return _AX6Util2.default.stopEvent(e.originalEvent),!1})},btnOnClick=function(e,t,i,l,s){var o=void 0;e.srcElement&&(e.target=e.srcElement),(l=_AX6Util2.default.findParentNode(e.target,function(e){if(e.getAttribute("data-modal-header-btn"))return!0}))&&(o={self:this,key:s=l.getAttribute("data-modal-header-btn"),value:t.header.btns[s],dialogId:t.id,btnTarget:l},t.header.btns[s].onClick&&t.header.btns[s].onClick.call(o,s)),o=null,t=null,l=null,s=null},onkeyup=function(e){e.keyCode==ax5.info.eventKeys.ESC&&this.close()},alignProcessor={"top-left":function(){this.align({left:"left",top:"top"})},"top-right":function(){this.align({left:"right",top:"top"})},"bottom-left":function(){this.align({left:"left",top:"bottom"})},"bottom-right":function(){this.align({left:"right",top:"bottom"})},"center-middle":function(){this.align({left:"center",top:"middle"})}},moveModal={on:function(){var e=this.activeModal.css("z-index"),t=this.activeModal.position(),i={width:this.activeModal.outerWidth(),height:this.activeModal.outerHeight()},l={width:(0,_jqmin2.default)(window).width(),height:(0,_jqmin2.default)(window).height(),scrollLeft:self.modalConfig.absolute?0:(0,_jqmin2.default)(document).scrollLeft(),scrollTop:self.modalConfig.absolute?0:(0,_jqmin2.default)(document).scrollTop()},s=function(e){return self.__dx=e.clientX-self.mousePosition.clientX,self.__dy=e.clientY-self.mousePosition.clientY,o>t.left+self.__dx?self.__dx=-t.left:d<t.left+self.__dx&&(self.__dx=d-t.left),n>t.top+self.__dy?self.__dy=-t.top:a<t.top+self.__dy&&(self.__dy=a-t.top),{left:t.left+self.__dx+l.scrollLeft,top:t.top+self.__dy+l.scrollTop}},o=0,d=l.width-i.width,n=0,a=l.height-i.height;self.__dx=0,self.__dy=0,self.resizerBg=(0,_jqmin2.default)('<div class="ax5modal-resizer-background" ondragstart="return false;"></div>'),self.resizer=(0,_jqmin2.default)('<div class="ax5modal-resizer" ondragstart="return false;"></div>'),self.resizerBg.css({zIndex:e}),self.resizer.css({left:t.left+l.scrollLeft,top:t.top+l.scrollTop,width:i.width,height:i.height,zIndex:e+1}),(0,_jqmin2.default)(document.body).append(self.resizerBg).append(self.resizer),self.activeModal.addClass("draged"),(0,_jqmin2.default)(document.body).on(ENM.mousemove+".ax5modal-move-"+this.instanceId,function(e){self.resizer.css(s(e))}).on(ENM.mouseup+".ax5modal-move-"+this.instanceId,function(e){moveModal.off.call(self)}).on("mouseleave.ax5modal-move-"+this.instanceId,function(e){moveModal.off.call(self)}),(0,_jqmin2.default)(document.body).attr("unselectable","on").css("user-select","none").on("selectstart",!1)},off:function(){this.activeModal.removeClass("draged"),function(){var e=this.resizer.offset();this.modalConfig.absolute||(e.left-=(0,_jqmin2.default)(document).scrollLeft(),e.top-=(0,_jqmin2.default)(document).scrollTop()),this.activeModal.css(e),this.modalConfig.left=e.left,this.modalConfig.top=e.top,e=null}.call(this),this.resizer.remove(),this.resizer=null,this.resizerBg.remove(),this.resizerBg=null,(0,_jqmin2.default)(document.body).off(ENM.mousemove+".ax5modal-move-"+this.instanceId).off(ENM.mouseup+".ax5modal-move-"+this.instanceId).off("mouseleave.ax5modal-move-"+this.instanceId),(0,_jqmin2.default)(document.body).removeAttr("unselectable").css("user-select","auto").off("selectstart"),onStateChanged.call(this,self.modalConfig,{self:this,state:"move"})}},resizeModal={on:function(e){var t=this.activeModal.css("z-index"),i=this.activeModal.position(),l={width:this.activeModal.outerWidth(),height:this.activeModal.outerHeight()},s={width:(0,_jqmin2.default)(window).width(),height:(0,_jqmin2.default)(window).height(),scrollLeft:this.modalConfig.absolute?0:(0,_jqmin2.default)(document).scrollLeft(),scrollTop:this.modalConfig.absolute?0:(0,_jqmin2.default)(document).scrollTop()},o={top:function(e){return a>l.height-self.__dy&&(self.__dy=l.height-a),e.shiftKey?(a>l.height-2*self.__dy&&(self.__dy=(l.height-a)/2),{left:i.left,top:i.top+self.__dy,width:l.width,height:l.height-2*self.__dy}):e.altKey?(a>l.height-2*self.__dy&&(self.__dy=(l.height-a)/2),{left:i.left+self.__dy,top:i.top+self.__dy,width:l.width-2*self.__dy,height:l.height-2*self.__dy}):{left:i.left,top:i.top+self.__dy,width:l.width,height:l.height-self.__dy}},bottom:function(e){return a>l.height+self.__dy&&(self.__dy=-l.height+a),e.shiftKey?(a>l.height+2*self.__dy&&(self.__dy=(-l.height+a)/2),{left:i.left,top:i.top-self.__dy,width:l.width,height:l.height+2*self.__dy}):e.altKey?(a>l.height+2*self.__dy&&(self.__dy=(-l.height+a)/2),{left:i.left-self.__dy,top:i.top-self.__dy,width:l.width+2*self.__dy,height:l.height+2*self.__dy}):{left:i.left,top:i.top,width:l.width,height:l.height+self.__dy}},left:function(e){return n>l.width-self.__dx&&(self.__dx=l.width-n),e.shiftKey?(n>l.width-2*self.__dx&&(self.__dx=(l.width-n)/2),{left:i.left+self.__dx,top:i.top,width:l.width-2*self.__dx,height:l.height}):e.altKey?(n>l.width-2*self.__dx&&(self.__dx=(l.width-n)/2),{left:i.left+self.__dx,top:i.top+self.__dx,width:l.width-2*self.__dx,height:l.height-2*self.__dx}):{left:i.left+self.__dx,top:i.top,width:l.width-self.__dx,height:l.height}},right:function(e){return n>l.width+self.__dx&&(self.__dx=-l.width+n),e.shiftKey?(n>l.width+2*self.__dx&&(self.__dx=(-l.width+n)/2),{left:i.left-self.__dx,top:i.top,width:l.width+2*self.__dx,height:l.height}):e.altKey?(n>l.width+2*self.__dx&&(self.__dx=(-l.width+n)/2),{left:i.left-self.__dx,top:i.top-self.__dx,width:l.width+2*self.__dx,height:l.height+2*self.__dx}):{left:i.left,top:i.top,width:l.width+self.__dx,height:l.height}},"top-left":function(e){return n>l.width-self.__dx&&(self.__dx=l.width-n),a>l.height-self.__dy&&(self.__dy=l.height-a),e.shiftKey||e.altKey?(a>l.height-2*self.__dy&&(self.__dy=(l.height-a)/2),n>l.width-2*self.__dx&&(self.__dx=(l.width-n)/2),{left:i.left+self.__dx,top:i.top+self.__dy,width:l.width-2*self.__dx,height:l.height-2*self.__dy}):(a>l.height-2*self.__dy&&(self.__dy=(l.height-a)/2),n>l.width-2*self.__dx&&(self.__dx=(l.width-n)/2),{left:i.left+self.__dx,top:i.top+self.__dy,width:l.width-self.__dx,height:l.height-self.__dy})},"top-right":function(e){return n>l.width+self.__dx&&(self.__dx=-l.width+n),a>l.height-self.__dy&&(self.__dy=l.height-a),e.shiftKey||e.altKey?(a>l.height-2*self.__dy&&(self.__dy=(l.height-a)/2),n>l.width+2*self.__dx&&(self.__dx=(-l.width+n)/2),{left:i.left-self.__dx,top:i.top+self.__dy,width:l.width+2*self.__dx,height:l.height-2*self.__dy}):{left:i.left,top:i.top+self.__dy,width:l.width+self.__dx,height:l.height-self.__dy}},"bottom-left":function(e){return n>l.width-self.__dx&&(self.__dx=l.width-n),a>l.height+self.__dy&&(self.__dy=-l.height+a),e.shiftKey||e.altKey?(n>l.width-2*self.__dx&&(self.__dx=(l.width-n)/2),a>l.height+2*self.__dy&&(self.__dy=(-l.height+a)/2),{left:i.left+self.__dx,top:i.top-self.__dy,width:l.width-2*self.__dx,height:l.height+2*self.__dy}):{left:i.left+self.__dx,top:i.top,width:l.width-self.__dx,height:l.height+self.__dy}},"bottom-right":function(e){return n>l.width+self.__dx&&(self.__dx=-l.width+n),a>l.height+self.__dy&&(self.__dy=-l.height+a),e.shiftKey||e.altKey?(n>l.width+2*self.__dx&&(self.__dx=(-l.width+n)/2),a>l.height+2*self.__dy&&(self.__dy=(-l.height+a)/2),{left:i.left-self.__dx,top:i.top-self.__dy,width:l.width+2*self.__dx,height:l.height+2*self.__dy}):{left:i.left,top:i.top,width:l.width+self.__dx,height:l.height+self.__dy}}},d=function(t){return self.__dx=t.clientX-self.mousePosition.clientX,self.__dy=t.clientY-self.mousePosition.clientY,o[e](t)};this.modalConfig.absolute||(i.left+=s.scrollLeft,i.top+=s.scrollTop);var n=100,a=100,f={top:"row-resize",bottom:"row-resize",left:"col-resize",right:"col-resize","top-left":"nwse-resize","top-right":"nesw-resize","bottom-left":"nesw-resize","bottom-right":"nwse-resize"};self.__dx=0,self.__dy=0,self.resizerBg=(0,_jqmin2.default)('<div class="ax5modal-resizer-background" ondragstart="return false;"></div>'),self.resizer=(0,_jqmin2.default)('<div class="ax5modal-resizer" ondragstart="return false;"></div>'),self.resizerBg.css({zIndex:t,cursor:f[e]}),self.resizer.css({left:i.left,top:i.top,width:l.width,height:l.height,zIndex:t+1,cursor:f[e]}),(0,_jqmin2.default)(document.body).append(self.resizerBg).append(self.resizer),self.activeModal.addClass("draged"),(0,_jqmin2.default)(document.body).bind(ENM.mousemove+".ax5modal-resize-"+this.instanceId,function(e){self.resizer.css(d(e))}).bind(ENM.mouseup+".ax5modal-resize-"+this.instanceId,function(e){resizeModal.off.call(self)}).bind("mouseleave.ax5modal-resize-"+this.instanceId,function(e){resizeModal.off.call(self)}),(0,_jqmin2.default)(document.body).attr("unselectable","on").css("user-select","none").bind("selectstart",!1)},off:function(){this.activeModal.removeClass("draged"),function(){var e=this.resizer.offset();_jqmin2.default.extend(e,{width:this.resizer.width(),height:this.resizer.height()}),this.modalConfig.absolute||(e.left-=(0,_jqmin2.default)(document).scrollLeft(),e.top-=(0,_jqmin2.default)(document).scrollTop()),this.activeModal.css(e),this.modalConfig.left=e.left,this.modalConfig.top=e.top,this.modalConfig.width=e.width,this.modalConfig.height=e.height,this.$.body.css({height:e.height-this.modalConfig.headerHeight}),this.modalConfig.iframe&&(this.$["iframe-wrap"].css({height:e.height-this.modalConfig.headerHeight}),this.$.iframe.css({height:e.height-this.modalConfig.headerHeight})),e=null}.call(this),this.resizer.remove(),this.resizer=null,this.resizerBg.remove(),this.resizerBg=null,onStateChanged.call(this,self.modalConfig,{self:this,state:"resize"}),(0,_jqmin2.default)(document.body).unbind(ENM.mousemove+".ax5modal-resize-"+this.instanceId).unbind(ENM.mouseup+".ax5modal-resize-"+this.instanceId).unbind("mouseleave.ax5modal-resize-"+this.instanceId),(0,_jqmin2.default)(document.body).removeAttr("unselectable").css("user-select","auto").unbind("selectstart")}},AX6UIToast=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.config={id:"ax6ui-modal-"+i.instanceId,position:{left:"center",top:"middle",margin:10},minimizePosition:"bottom-right",clickEventName:"ontouchstart"in document.documentElement?"touchstart":"click",theme:"default",width:300,height:400,closeToEsc:!0,disableDrag:!1,disableResize:!1,animateTime:250,iframe:!1},_jqmin2.default.extend(!0,i.config,e),i.$activeModal=null,i.watingModal=!1,i.$={},void 0!==e&&i.init(),i}return _inherits(t,_AX6UICore3.default),_createClass(t,[{key:"init",value:function(){this.onStateChanged=this.config.onStateChanged,delete this.config.onStateChanged,this.initOnce()}},{key:"initOnce",value:function(){if(this.initialized)return this;this.initialized=!0}}]),t}();exports.default=AX6UIToast;
//# sourceMappingURL=AX6UIModal.js.map
