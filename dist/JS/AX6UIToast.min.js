"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),_jqmin=require("jqmin"),_jqmin2=_interopRequireDefault(_jqmin),_AX6Util=require("./AX6Util.js"),_AX6Util2=_interopRequireDefault(_AX6Util),_AX6UICore2=require("./AX6UICore.js"),_AX6UICore3=_interopRequireDefault(_AX6UICore2),_AX6Mustache=require("./AX6Mustache"),_AX6Mustache2=_interopRequireDefault(_AX6Mustache),tmpl={display:function(t){return'\n<div id="{{toastId}}" data-ax6ui-toast="" class="{{theme}}">\n    {{#icon}}\n    <div class="ax-toast-icon">{{{.}}}</div>\n    {{/icon}}\n    <div class="ax-toast-body">{{{msg}}}</div>\n    {{#btns}}\n    <div class="ax-toast-buttons">\n        <div class="ax-button-wrap">\n            {{#@each}}\n            <button type="button" data-ax-toast-btn="{{@key}}" class="btn btn-{{@value.theme}}">{{{@value.label}}}</button>\n            {{/@each}}\n        </div>\n    </div>\n    {{/btns}}\n    {{^btns}}\n        <a class="ax-toast-close" data-ax-toast-btn="ok">{{{closeIcon}}}</a>\n    {{/btns}}\n    <div style="clear:both;"></div>\n</div>'}},onStateChanged=function(t,e){return t&&t.onStateChanged?t.onStateChanged.call(e,e):this.onStateChanged&&this.onStateChanged.call(e,e),t=null,e=null,!0},getContent=function(t,e){var n={toastId:t,theme:e.theme,icon:e.icon,msg:(e.msg||"").replace(/\n/g,"<br/>"),btns:e.btns,closeIcon:e.closeIcon};try{return _AX6Mustache2.default.render(tmpl.display.call(this),n)}finally{t=null,n=null}},open=function(t,e){var n=this;this.toastSeqClear&&clearTimeout(this.toastSeqClear);var i=void 0;t.width;if(t.id="ax6ui-toast-"+this.instanceId+"-"+ ++this.toastSeq,(0,_jqmin2.default)("#"+t.id).get(0))return this;(i=(0,_jqmin2.default)(getContent(t.id,t))).css({width:this.$toastContainer.width()}),"bottom"==_AX6Util2.default.left(this.config.containerPosition,"-")?this.$toastContainer.append(i):this.$toastContainer.prepend(i),t.$toastBox=i,this.queue.push(t),onStateChanged.call(this,t,{self:this,state:"open",toastId:t.id}),"push"===t.toastType?(setTimeout(function(){n.close(t,e)},this.config.displayTime),i.on(this.config.clickEventName,"[data-ax-toast-btn]",function(a){btnOnClick.call(n,a||window.event,t,i,e)})):"confirm"===t.toastType&&i.on(this.config.clickEventName,"[data-ax-toast-btn]",function(a){btnOnClick.call(n,a||window.event,t,i,e)})},btnOnClick=function(t,e,n,i,a,o){if(a=_AX6Util2.default.findParentNode(t.target,function(t){if(t.getAttribute("data-ax-toast-btn"))return!0})){var s={key:o=a.getAttribute("data-ax-toast-btn"),value:e.btns?e.btns[o]:o,toastId:e.id,btn_target:a};e.btns&&e.btns[o].onClick?e.btns[o].onClick.call(s,s):"push"===e.toastType?(i&&i.call(s,s),this.close(e,i)):"confirm"===e.toastType&&(i&&i.call(s,s),this.close(e))}t=null,e=null,i=null,a=null,o=null},AX6UIToast=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.config={clickEventName:"click",theme:"default",width:300,icon:"",closeIcon:"",msg:"",lang:{ok:"ok",cancel:"cancel"},displayTime:3e3,animateTime:250,containerPosition:"bottom-left",zIndex:9999},_jqmin2.default.extend(!0,n.config,t),n.$toastContainer=(0,_jqmin2.default)('<div data-ax6ui-toast-container="'+n.instanceId+'" data-toast-container-position=""></div>'),n.queue=[],n.toastSeq=0,n.toastSeqClear=null,(0,_jqmin2.default)(document.body).append(n.$toastContainer),n.init(),n}return _inherits(e,_AX6UICore3.default),_createClass(e,[{key:"init",value:function(){this.onStateChanged=this.config.onStateChanged,delete this.config.onStateChanged,this.$toastContainer.css({"z-index":this.config.zIndex,width:this.config.width,"max-width":"100%"}).attr("data-toast-container-position",this.config.containerPosition),this.initOnce()}},{key:"initOnce",value:function(){if(this.initialized)return this;this.initialized=!0}},{key:"push",value:function(t,e){return _AX6Util2.default.isString(t)&&(t={title:this.config.title,msg:t}),t.toastType="push",t=_jqmin2.default.extend(!0,{},this.config,t),open.call(this,t,e),t=null,e=null,this}},{key:"confirm",value:function(t,e){return _AX6Util2.default.isString(t)&&(t={title:this.config.title,msg:t}),t.toastType="confirm",void 0===(t=_jqmin2.default.extend(!0,{},this.config,t)).btns&&(t.btns={ok:{label:t.lang.ok,theme:t.theme}}),open.call(this,t,e),t=null,e=null,this}},{key:"close",value:function(t,e){var n=t.$toastBox;return n.addClass("push"==t.toastType?"removed":"destroy"),this.queue=_AX6Util2.default.filter(this.queue,function(){return t.id!=this.id}),setTimeout(function(){var i={toastId:t.id};n.remove(),e&&e.call(i,i),i={self:this,state:"close",toastId:t.id},onStateChanged.call(this,t,i),0===this.queue.length&&(this.toastSeqClear&&clearTimeout(this.toastSeqClear),this.toastSeqClear=setTimeout(function(){0===this.queue.length&&(this.toastSeq=0)}.bind(this),3e3)),i=null,t=null,e=null,n=null}.bind(this),t.animateTime),this}}]),e}();exports.default=AX6UIToast;
//# sourceMappingURL=AX6UIToast.js.map
