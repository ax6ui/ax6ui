"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _jqmin=require("jqmin"),_jqmin2=_interopRequireDefault(_jqmin),_AX6Util=require("../AX6Util"),_AX6Util2=_interopRequireDefault(_AX6Util),_AX6UIGrid_util=require("./AX6UIGrid_util"),_AX6UIGrid_util2=_interopRequireDefault(_AX6UIGrid_util),_AX6UIGrid_body=require("./AX6UIGrid_body"),_AX6UIGrid_body2=_interopRequireDefault(_AX6UIGrid_body),_AX6UIGrid_data=require("./AX6UIGrid_data"),_AX6UIGrid_data2=_interopRequireDefault(_AX6UIGrid_data),columnResizerEvent={on:function(e,t){var r=this,i=$(e).offset().left,o=r.$.container.root.offset().left;r.xvar.columnResizerIndex=t;var l={min:2-r.colGroup[t]._width,max:r.$.container.root.width()-r.colGroup[t]._width};(0,_jqmin2.default)(document.body).on(_AX6UIGrid_util2.default.ENM.mousemove+".ax5grid-"+this.instanceId,function(e){var t=_AX6UIGrid_util2.default.getMousePosition(e);r.xvar.__da=t.clientX-r.xvar.mousePosition.clientX,l.min>r.xvar.__da?r.xvar.__da=l.min:l.max<r.xvar.__da&&(r.xvar.__da=l.max),r.xvar.columnResizerLived||r.$.resizer.horizontal.addClass("live"),r.xvar.columnResizerLived=!0,r.$.resizer.horizontal.css({left:i+r.xvar.__da-o})}).on(_AX6UIGrid_util2.default.ENM.mouseup+".ax5grid-"+this.instanceId,function(e){columnResizerEvent.off.call(r),_AX6Util2.default.stopEvent(e)}).on("mouseleave.ax5grid-"+this.instanceId,function(e){columnResizerEvent.off.call(r),_AX6Util2.default.stopEvent(e)}),(0,_jqmin2.default)(document.body).attr("unselectable","on").css("user-select","none").on("selectstart",!1)},off:function(){this.$.resizer.horizontal.removeClass("live"),this.xvar.columnResizerLived=!1,void 0===this.xvar.__da||this.setColumnWidth(this.colGroup[this.xvar.columnResizerIndex]._width+this.xvar.__da,this.xvar.columnResizerIndex),(0,_jqmin2.default)(document.body).off(_AX6UIGrid_util2.default.ENM.mousemove+".ax5grid-"+this.instanceId).off(_AX6UIGrid_util2.default.ENM.mouseup+".ax5grid-"+this.instanceId).off("mouseleave.ax5grid-"+this.instanceId),(0,_jqmin2.default)(document.body).removeAttr("unselectable").css("user-select","auto").off("selectstart")}},init=function(){var e=this;this.$.container.header.on("click","[data-ax6grid-column-attr]",function(t){var r=this.getAttribute("data-ax6grid-column-key"),i=this.getAttribute("data-ax6grid-column-colindex"),o=e.colGroup[i];if("__checkbox_header__"===r&&e.config.header.selector){var l=this.getAttribute("data-ax6grid-selected");l=!!_AX6Util2.default.isNothing(l)||"true"!==l,$(this).attr("data-ax6grid-selected",l),e.selectAll({selected:l}),l=null}else r&&o&&!1!==o.sortable&&!o.sortFixed&&(!0!==o.sortable&&!0!==e.config.sortable||toggleSort.call(e,o.key));_AX6UIGrid_body2.default.blur.call(e),r=null,i=null,o=null}),this.$.container.header.on("mousedown","[data-ax6grid-column-resizer]",function(t){var r=this.getAttribute("data-ax6grid-column-resizer");e.xvar.mousePosition=_AX6UIGrid_util2.default.getMousePosition(t),columnResizerEvent.on.call(e,this,Number(r)),_AX6Util2.default.stopEvent(t),r=null}).on("dragstart",function(e){return _AX6Util2.default.stopEvent(e),!1}),resetFrozenColumn.call(this)},resetFrozenColumn=function(){var e=this.config,t=_AX6UIGrid_util2.default.divideTableByFrozenColumnIndex(this.headerTable,this.xvar.frozenColumnIndex);this.asideHeaderData=function(t){for(var r=[],i={rows:[]},o=0,l=t.rows.length;o<l;o++)if(i.rows[o]={cols:[]},0===o){var a={label:"",colspan:1,rowspan:t.rows.length,colIndex:null},n={};e.showLineNumber&&(n=_jqmin2.default.extend({},a,{width:e.lineNumberColumnWidth,_width:e.lineNumberColumnWidth,columnAttr:"lineNumber",key:"__index_header__",label:"&nbsp;"}),r.push(n),i.rows[o].cols.push(n)),e.showRowSelector&&(n=_jqmin2.default.extend({},a,{width:e.rowSelectorColumnWidth,_width:e.rowSelectorColumnWidth,columnAttr:"rowSelector",key:"__checkbox_header__",label:""}),r.push(n),i.rows[o].cols.push(n)),a=null}return this.asideColGroup=r,i}.call(this,this.headerTable),this.leftHeaderData=t.leftData,this.headerData=t.rightData},getFieldValue=function(e){return"__checkbox_header__"===e.key?this.config.header.selector?'<div class="checkBox" style="max-height: '+(e.width-10)+"px;min-height: "+(e.width-10)+'px;"></div>':"&nbsp;":e.label||"&nbsp;"},repaint=function(e){var t=this.config,r=this.colGroup;e&&(resetFrozenColumn.call(this),this.xvar.paintStartRowIndex=void 0,this.xvar.virtualPaintStartRowIndex=void 0);var i=this.asideHeaderData,o=this.leftHeaderData,l=this.headerData,a=t.header.align;this.leftHeaderColGroup=r.slice(0,this.config.frozenColumnIndex),this.headerColGroup=r.slice(this.config.frozenColumnIndex);var n=function(e,i,o){var l=0,n=[];n.push('<table border="0" cellpadding="0" cellspacing="0">'),n.push("<colgroup>");for(var s=0,d=i.length;s<d;s++)n.push('<col style="width:'+i[s]._width+'px;"  />'),l+=i[s]._width;n.push("<col  />"),n.push("</colgroup>");for(var u=0,h=o.rows.length;u<h;u++){n.push('<tr class="">');for(var c=0,f=o.rows[u].cols.length;c<f;c++){var _=o.rows[u].cols[c],p=t.header.columnHeight*_.rowspan-t.header.columnBorderWidth,m=a||_.align;n.push("<td ",'data-ax6grid-column-attr="'+(_.columnAttr||"default")+'" ','data-ax6grid-column-row="'+u+'" ','data-ax6grid-column-col="'+c+'" ',void 0!==_.key?'data-ax6grid-column-key="'+_.key+'" ':"",'data-ax6grid-column-colindex="'+_.colIndex+'" ','data-ax6grid-column-rowindex="'+_.rowIndex+'" ','colspan="'+_.colspan+'" ','rowspan="'+_.rowspan+'" ','class="'+function(e){var r="";return e.headerStyleClass&&(_AX6Util2.default.isFunction(e.headerStyleClass)?r+=e.headerStyleClass.call({column:e,key:e.key})+" ":r+=e.headerStyleClass+" "),t.header.columnBorderWidth&&(r+="hasBorder "),c==f-1&&(r+="isLastColumn "),r}.call(this,_)+'" ','style="height: '+p+'px;min-height: 1px;">'),n.push(function(){var e=t.header.columnHeight-2*t.header.columnPadding-t.header.columnBorderWidth;return'<span data-ax6grid-cellHolder="" '+(m?'data-ax6grid-text-align="'+m+'"':"")+' style="height: '+(t.header.columnHeight-t.header.columnBorderWidth)+"px;line-height: "+e+'px;">'}(),function(){var e="";return _AX6Util2.default.isNothing(_.key)||_AX6Util2.default.isNothing(_.colIndex)||!0!==t.sortable&&!0!==_.sortable||!1===_.sortable||(e+='<span data-ax6grid-column-sort="'+_.colIndex+'" data-ax6grid-column-sort-order="'+(r[_.colIndex].sort||"")+'" />'),e}(),getFieldValue.call(this,_),"</span>"),_AX6Util2.default.isNothing(_.colIndex)||t.enableFilter&&n.push('<span data-ax6grid-column-filter="'+_.colIndex+'" data-ax6grid-column-filter-value=""  />'),n.push("</td>")}n.push("<td ",'data-ax6grid-column-row="null" ','data-ax6grid-column-col="null" ','style="height: '+t.header.columnHeight+'px;min-height: 1px;" ',"></td>"),n.push("</tr>")}return n.push("</table>"),e.html(n.join("")),function(){for(var r=t.header.columnHeight*o.rows.length-t.header.columnBorderWidth,l=0,a=[],n=0,s=i.length;n<s;n++){var d=i[n];_AX6Util2.default.isNothing(d.colIndex)||(l+=d._width,a.push('<div data-ax6grid-column-resizer="'+d.colIndex+'" style="height:'+r+"px;left: "+(l-4)+'px;"  />'))}e.append(a)}.call(this),l};t.asidePanelWidth>0&&n.call(this,this.$.panel["aside-header"],this.asideColGroup,i),t.frozenColumnIndex>0&&n.call(this,this.$.panel["left-header"],this.leftHeaderColGroup,o),this.xvar.scrollContentWidth=n.call(this,this.$.panel["header-scroll"],this.headerColGroup,l),t.rightSum},scrollTo=function(e){return this.$.panel["header-scroll"].css(e),this},toggleSort=function(e){var t="",r={},i=0;for(var o in this.sortInfo)this.sortInfo[o].fixed&&(r[o]=this.sortInfo[o],i++);for(var l=0,a=this.colGroup.length;l<a;l++)this.colGroup[l].key==e?(""==t&&(t=void 0===this.colGroup[l].sort?"desc":"desc"===this.colGroup[l].sort?"asc":void 0),this.colGroup[l].sort=t):this.config.multiSort||(this.colGroup[l].sort=void 0),void 0!==this.colGroup[l].sort&&(r[this.colGroup[l].key]||(r[this.colGroup[l].key]={seq:i++,orderBy:this.colGroup[l].sort}));return this.setColumnSort(r),this},applySortStatus=function(e){for(var t=0,r=this.colGroup.length;t<r;t++)for(var i in e)this.colGroup[t].key==i&&(this.colGroup[t].sort=e[i].orderBy);return this},select=function(e){_AX6UIGrid_data2.default.select.call(this,dindex,e&&e.selected),_AX6UIGrid_body2.default.updateRowState.call(this,["selected"],dindex)},getExcelString=function(){this.config;var e=this.colGroup,t=this.headerTable;return function(e,t){for(var r=[],i=0,o=t.rows.length;i<o;i++){r.push("<tr>");for(var l=0,a=t.rows[i].cols.length;l<a;l++){var n=t.rows[i].cols[l];r.push("<td ",'colspan="'+n.colspan+'" ','rowspan="'+n.rowspan+'" ',">",getFieldValue.call(this,n),"</td>")}r.push("</tr>")}return r.join("")}.call(this,e,t)};exports.default={init:init,repaint:repaint,scrollTo:scrollTo,toggleSort:toggleSort,applySortStatus:applySortStatus,getExcelString:getExcelString};
//# sourceMappingURL=AX6UIGrid_header.js.map
