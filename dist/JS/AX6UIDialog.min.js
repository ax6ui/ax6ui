"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),_jqmin=require("jqmin"),_jqmin2=_interopRequireDefault(_jqmin),_AX6UICore2=require("./AX6UICore.js"),_AX6UICore3=_interopRequireDefault(_AX6UICore2),_AX6Util=require("./AX6Util.js"),_AX6Util2=_interopRequireDefault(_AX6Util),_AX6Info=require("./AX6Info.js"),_AX6Info2=_interopRequireDefault(_AX6Info),_AX6Mustache=require("./AX6Mustache.js"),_AX6Mustache2=_interopRequireDefault(_AX6Mustache),dialogTmpl=function(t){return' \n<div id="{{dialogId}}" data-dialog-els="root" data-ax6ui-dialog="" class="{{theme}}">\n    <div class="ax-dialog-header" data-dialog-els="header">\n        {{{title}}}\n    </div>\n    <div class="ax-dialog-body" data-dialog-els="body">\n        <div class="ax-dialog-msg">{{{msg}}}</div>\n        \n        {{#input}}\n        <div class="ax-dialog-prompt">\n            {{#@each}}\n            <div class="form-group">\n            {{#@value.label}}\n            <label>{{#_crlf}}{{{.}}}{{/_crlf}}</label>\n            {{/@value.label}}\n            <input type="{{@value.type}}" placeholder="{{@value.placeholder}}" class="form-control {{@value.theme}}" data-dialog-prompt="{{@key}}" style="width:100%;" value="{{@value.value}}" />\n            {{#@value.help}}\n            <p class="help-block">{{#_crlf}}{{.}}{{/_crlf}}</p>\n            {{/@value.help}}\n            </div>\n            {{/@each}}\n        </div>\n        {{/input}}\n        \n        <div class="ax-dialog-buttons" data-dialog-els="buttons">\n            <div class="ax-button-wrap">\n            {{#btns}}\n                {{#@each}}\n                <button type="button" data-dialog-btn="{{@key}}" class="btn btn-{{@value.theme}}">{{@value.label}}</button>\n                {{/@each}}\n            {{/btns}}\n            </div>\n        </div>\n        \n        {{#additionalContent}}\n        <div data-dialog-els="additional-content">{{{.}}}</div>\n        {{/additionalContent}}\n    </div>\n</div>  \n'},onStateChanged=function(t,e){return t&&t.onStateChanged?t.onStateChanged.call(e,e):this.onStateChanged&&this.onStateChanged.call(e,e),t=null,e=null,!0},getContent=function(t,e){var i={dialogId:t,title:e.title||this.config.title||"",msg:(e.msg||this.config.msg||"").replace(/\n/g,"<br/>"),input:e.input,btns:e.btns,_crlf:function(){return this.replace(/\n/g,"<br/>")},additionalContent:function(t){return _AX6Util2.default.isFunction(t)?t.call(e):t}(e.additionalContent)};return _AX6Mustache2.default.render(dialogTmpl.call(this),i)},open=function(t,e){var i=this,n={},l={width:t.width};this.dialogConfig=t,this.$activeDialog=(0,_jqmin2.default)(getContent.call(this,t.id,t)),this.$activeDialog.css({width:l.width}),(0,_jqmin2.default)(document.body).append(this.$activeDialog),void 0===e&&(e=t.callback),t.height=l.height=this.$activeDialog.height(),void 0===t.position||"center"===t.position?(n.top=(0,_jqmin2.default)(window).height()/2-l.height/2,n.left=(0,_jqmin2.default)(window).width()/2-l.width/2):(n.left=t.position.left||0,n.top=t.position.top||0),this.config.zIndex&&(n["z-index"]=this.config.zIndex),this.$activeDialog.css(n).on(t.clickEventName,"[data-dialog-btn]",function(n){btnOnClick.call(i,n||window.event,t,e)}).find("prompt"===t.dialogType?"[data-dialog-prompt]":"[data-dialog-btn]").trigger("focus"),(0,_jqmin2.default)(window).on("keydown.ax6dialog",function(n){onKeyup.call(i,n||window.event,t,e)}).on("resize.ax6dialog",_AX6Util2.default.throttle(function(t){align.call(this,t||window.event)},30).bind(this)),onStateChanged.call(this,t,{self:this,state:"open"}),t.autoCloseTime&&(this.autoCloseTimer=setTimeout(function(){i.close()},t.autoCloseTime)),n=null,l=null},align=function(t){if(!this.$activeDialog)return this;var e=this.dialogConfig,i={width:e.width,height:e.height};return void 0===e.position||"center"===e.position?(i.top=window.innerHeight/2-i.height/2,i.left=window.innerWidth/2-i.width/2):(i.left=e.position.left||0,i.top=e.position.top||0),i.left<0&&(i.left=0),i.top<0&&(i.top=0),this.$activeDialog.css(i),e=null,i=null,this},btnOnClick=function(t,e,i,n,l){var a=void 0,o=null;if(t.srcElement&&(t.target=t.srcElement),n=_AX6Util2.default.findParentNode(t.target,function(t){if(t.getAttribute("data-dialog-btn"))return!0})){if(l=n.getAttribute("data-dialog-btn"),a={self:this,key:l,value:e.btns[l],dialogId:e.id,btnTarget:n},"prompt"===e.dialogType){a.input={};for(var s in e.input)if(a.input[s]=this.$activeDialog.find("[data-dialog-prompt="+s+"]").val(),e.input[s].required&&(""==a.input[s]||null==a.input[s])){o=s;break}}if(e.btns[l].onClick)e.btns[l].onClick.call(a,a);else if("alert"===e.dialogType)i&&i.call(a,a),this.close({doNotCallback:!0});else if("confirm"===e.dialogType)i&&i.call(a,a),this.close({doNotCallback:!0});else if("prompt"===e.dialogType){if("ok"===l&&o)return this.$activeDialog.find('[data-dialog-prompt="'+o+'"]').get(0).focus(),!1;i&&i.call(a,a),this.close({doNotCallback:!0})}}a=null,e=null,i=null,n=null,l=null},onKeyup=function(t,e,i,n,l){var a=void 0,o=null;if(t.keyCode==_AX6Info2.default.eventKeys.ESC&&this.close(),"prompt"===e.dialogType&&t.keyCode==_AX6Info2.default.eventKeys.RETURN){(a={self:this,key:l,value:e.btns[l],dialogId:e.id,btnTarget:n}).input={};for(var s in e.input)if(a.input[s]=this.$activeDialog.find("[data-dialog-prompt="+s+"]").val(),e.input[s].required&&(""==a.input[s]||null==a.input[s])){o=s;break}if(o)return a=null,o=null,!1;i&&i.call(a,a),this.close({doNotCallback:!0})}a=null,o=null,e=null,i=null,n=null,l=null},AX6UIDialog=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.config={id:"ax6-dialog-"+i.instanceId,clickEventName:"click",theme:"default",width:300,title:"AX6UIDialog",msg:"",lang:{ok:"ok",cancel:"cancel"},animateTime:150,autoCloseTime:0},_jqmin2.default.extend(!0,i.config,t),i.queue=[],i.$activeDialog=null,i.autoCloseTimer=null,i.init(),i}return _inherits(e,_AX6UICore3.default),_createClass(e,[{key:"init",value:function(){this.onStateChanged=this.config.onStateChanged,delete this.config.onStateChanged,this.initOnce()}},{key:"initOnce",value:function(){if(this.initialized)return this;this.initialized=!0}},{key:"alert",value:function(t,e,i){void 0===t?t={title:this.config.title,msg:""}:_AX6Util2.default.isString(t)&&(t={title:this.config.title,msg:t}),void 0===(t=_jqmin2.default.extend(!0,{},this.config,t,{dialogType:"alert",callback:e})).btns&&(t.btns={ok:{label:t.lang.ok,theme:t.theme}}),this.$activeDialog?this.queue.push(t):open.call(this,t,e)}},{key:"confirm",value:function(t,e,i){return void 0===t?t={title:this.config.title,msg:""}:_AX6Util2.default.isString(t)&&(t={title:this.config.title,msg:t}),void 0===(t=_jqmin2.default.extend(!0,{},this.config,t,{dialogType:"confirm",callback:e})).btns&&(t.btns={ok:{label:t.lang.ok,theme:t.theme},cancel:{label:t.lang.cancel}}),this.$activeDialog?this.queue.push(t):open.call(this,t,e),this}},{key:"prompt",value:function(t,e,i){return void 0===t?t={title:this.config.title,msg:""}:_AX6Util2.default.isString(t)&&(t={title:this.config.title,msg:t}),void 0===(t=_jqmin2.default.extend(!0,{},this.config,t,{dialogType:"prompt",callback:e})).input&&(t.input={value:{label:""}}),void 0===t.btns&&(t.btns={ok:{label:t.lang.ok,theme:t.theme},cancel:{label:t.lang.cancel}}),this.$activeDialog?this.queue.push(t):open.call(this,t,e),this}},{key:"close",value:function(t){var e=void 0,i=void 0;return this.$activeDialog&&(this.autoCloseTimer&&clearTimeout(this.autoCloseTimer),e=this.dialogConfig,this.$activeDialog.addClass("destroy"),(0,_jqmin2.default)(window).off("keydown.ax6dialog").off("resize.ax6dialog"),setTimeout(function(){this.$activeDialog&&(this.$activeDialog.remove(),this.$activeDialog=null),i={self:this,state:"close",dialogId:e.id},t&&_AX6Util2.default.isFunction(t.callback)?t.callback.call(i,i):!e.callback||t&&t.doNotCallback||e.callback.call(i,i),e&&e.onStateChanged?e.onStateChanged.call(i,i):this.onStateChanged&&this.onStateChanged.call(i,i),this.queue&&this.queue.length&&open.call(this,this.queue.shift()),e=null,i=null}.bind(this),this.config.animateTime)),this}}]),e}();exports.default=AX6UIDialog;
//# sourceMappingURL=AX6UIDialog.js.map
